<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>3&nbsp; Simple AgroClimate Metrics – AgroClimate Cookbook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04_degday.html" rel="next">
<link href="./02_weather-data.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-364982630eef5352dd1537128a8ed5cb.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="application/json" class="js-hypothesis-config">
{
  "theme": "clean",
  "openSidebar": false
}
</script><script async="" src="https://hypothes.is/embed.js"></script><script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script><link href="site_libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script><script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><link href="site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-1.3.1/leaflet.js"></script><link href="site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="site_libs/proj4-2.6.2/proj4.min.js"></script><script src="site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-binding-2.2.3/leaflet.js"></script><script src="site_libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script><script src="site_libs/leaflet-providers-plugin-2.2.3/leaflet-providers-plugin.js"></script><link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script><script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03_simple-agroclim-metrics.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Simple AgroClimate Metrics</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">AgroClimate Cookbook</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/ucanr-igis/agroclimate-cookbook/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_data-wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Data Wrangling Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_weather-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Weather Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_simple-agroclim-metrics.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Simple AgroClimate Metrics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_degday.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Degree Days</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_chill.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Chill</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_agroclimate-rasters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Agroclimate Rasters</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_modeled-climate-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Modeled Climate Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_climate-analogues.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">AgroClimate Analogues</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99_other.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Other Content, Future Work</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="4"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#load-packages" id="toc-load-packages" class="nav-link active" data-scroll-target="#load-packages"><span class="header-section-number">3.1</span> Load Packages</a></li>
  <li><a href="#fetch-some-data" id="toc-fetch-some-data" class="nav-link" data-scroll-target="#fetch-some-data"><span class="header-section-number">3.2</span> Fetch Some Data</a></li>
  <li><a href="#growing-degree-days" id="toc-growing-degree-days" class="nav-link" data-scroll-target="#growing-degree-days"><span class="header-section-number">3.3</span> Growing Degree Days</a></li>
  <li><a href="#chill-accumulation" id="toc-chill-accumulation" class="nav-link" data-scroll-target="#chill-accumulation"><span class="header-section-number">3.4</span> Chill Accumulation</a></li>
  <li><a href="#frost-days" id="toc-frost-days" class="nav-link" data-scroll-target="#frost-days"><span class="header-section-number">3.5</span> Frost Days</a></li>
  <li><a href="#last-spring-and-first-fall-freeze" id="toc-last-spring-and-first-fall-freeze" class="nav-link" data-scroll-target="#last-spring-and-first-fall-freeze"><span class="header-section-number">3.6</span> Last Spring and First Fall Freeze</a></li>
  <li><a href="#freeze-free-season" id="toc-freeze-free-season" class="nav-link" data-scroll-target="#freeze-free-season"><span class="header-section-number">3.7</span> Freeze-Free Season</a></li>
  <li><a href="#tropical-nights-and-hot-days" id="toc-tropical-nights-and-hot-days" class="nav-link" data-scroll-target="#tropical-nights-and-hot-days"><span class="header-section-number">3.8</span> Tropical Nights and Hot Days</a></li>
  <li><a href="#extreme-heat-days" id="toc-extreme-heat-days" class="nav-link" data-scroll-target="#extreme-heat-days"><span class="header-section-number">3.9</span> Extreme Heat Days</a></li>
  <li><a href="#heatwaves" id="toc-heatwaves" class="nav-link" data-scroll-target="#heatwaves"><span class="header-section-number">3.10</span> Heatwaves</a></li>
  <li><a href="#diurnal-temperature-range" id="toc-diurnal-temperature-range" class="nav-link" data-scroll-target="#diurnal-temperature-range"><span class="header-section-number">3.11</span> Diurnal Temperature Range</a></li>
  <li><a href="#reference-evapotranspiration" id="toc-reference-evapotranspiration" class="nav-link" data-scroll-target="#reference-evapotranspiration"><span class="header-section-number">3.12</span> Reference Evapotranspiration</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/ucanr-igis/agroclimate-cookbook/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/ucanr-igis/agroclimate-cookbook/edit/main/03_simple-agroclim-metrics.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-simple-metrics" class="quarto-section-identifier"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Simple AgroClimate Metrics</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p><span class="citation" data-cites="parker_observed_2022">Parker et al. (<a href="references.html#ref-parker_observed_2022" role="doc-biblioref">2022</a>)</span> identify a dozen agroclimate metrics derived 100% from weather data and provide physiologically relevant information for growers. This chapter provides R code to compute most of these agroclimate metrics using historic observed data from Cal-Adapt.</p>
<section id="load-packages" class="level2" data-number="3.1"><h2 data-number="3.1" class="anchored" data-anchor-id="load-packages">
<span class="header-section-number">3.1</span> Load Packages</h2>
<p>As usual, we start by loading a bunch of packages into memory and specifying our preferences for conflicting function names:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ucanr-igis.github.io/caladaptr">caladaptr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-quantities.github.io/units/">units</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/">sf</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Set conflicted preferences:</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://conflicted.r-lib.org/">conflicted</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://conflicted.r-lib.org/reference/conflict_prefer.html">conflict_prefer</a></span><span class="op">(</span><span class="st">"filter"</span>, <span class="st">"dplyr"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://conflicted.r-lib.org/reference/conflict_prefer.html">conflict_prefer</a></span><span class="op">(</span><span class="st">"count"</span>, <span class="st">"dplyr"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://conflicted.r-lib.org/reference/conflict_prefer.html">conflict_prefer</a></span><span class="op">(</span><span class="st">"select"</span>, <span class="st">"dplyr"</span>, quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="fetch-some-data" class="level2" data-number="3.2"><h2 data-number="3.2" class="anchored" data-anchor-id="fetch-some-data">
<span class="header-section-number">3.2</span> Fetch Some Data</h2>
<p>To compute agroclimate metrics, we’ll first get 20 years of observed data from the gridMet dataset for a location in Colusa County in the Sacramento Valley.</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colusa_cap</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ucanr-igis.github.io/caladaptr/reference/ca_loc_pt.html">ca_loc_pt</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">122.159304</span>, <span class="fl">39.289291</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ucanr-igis.github.io/caladaptr/reference/ca_slug.html">ca_slug</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"tmmn_day_gridmet"</span>, <span class="st">"tmmx_day_gridmet"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ucanr-igis.github.io/caladaptr/reference/ca_years.html">ca_years</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fl">2000</span>, end <span class="op">=</span> <span class="fl">2020</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">colusa_cap</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cal-Adapt API Request
Location(s): 
  x: -122.159
  y: 39.289
Slug(s): tmmn_day_gridmet, tmmx_day_gridmet
Dates: 2000-01-01 to 2020-12-31
 </code></pre>
</div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colusa_cap</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://ucanr-igis.github.io/caladaptr/reference/ca_preflight.html">ca_preflight</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>General issues
 - none found
Issues for querying values
 - none found
Issues for downloading rasters
 - none found</code></pre>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">colusa_cap</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item" id="htmlwidget-05043a7c2b1b318751af" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-05043a7c2b1b318751af">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"attributionControl":true},"calls":[{"method":"createMapPane","args":["tmap402",402]},{"method":"addLayersControl","args":[[],"Query Location(s)",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addProviderTiles","args":["OpenStreetMap",null,"OpenStreetMap",{"minZoom":0,"maxZoom":18,"maxNativeZoom":17,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addCircleMarkers","args":[39.28929099999999,-122.159304,1.4,"0000001","Query Location(s)",{"interactive":true,"className":"","pane":"tmap402","stroke":true,"color":"#FF0000","weight":1,"opacity":1,"fill":true,"fillColor":"#999999","fillOpacity":0.8},null,null,"<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>0000001<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>id<\/nobr><\/td><td align=\"right\"><nobr>1<\/nobr><\/td><\/tr><\/table><\/div>",null,null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]}],"fitBounds":[38.76929099999999,-122.679304,39.80929099999999,-121.639304,[]],"limits":{"lat":[39.28929099999999,39.28929099999999],"lng":[-122.159304,-122.159304]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><br></p>
<p>Next we fetch the data. While we’re at it, we’ll add columns for the climate variable (based on the slug), year, and temperature in Fahrenheit:</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colusa_tbl</span> <span class="op">&lt;-</span> <span class="va">colusa_cap</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ucanr-igis.github.io/caladaptr/reference/ca_getvals_tbl.html">ca_getvals_tbl</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span>,</span>
<span>         year <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/year.html">year</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         cvar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html">substr</a></span><span class="op">(</span><span class="va">slug</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>         temp_f <span class="op">=</span> <span class="fu">units</span><span class="fu">::</span><span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html">set_units</a></span><span class="op">(</span><span class="va">val</span>, <span class="va">degF</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">dt</span>, <span class="va">cvar</span>, <span class="va">temp_f</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">colusa_tbl</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 15,342
Columns: 4
$ year   &lt;dbl&gt; 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 200…
$ dt     &lt;date&gt; 2000-01-01, 2000-01-02, 2000-01-03, 2000-01-04, 2000-01-05, 20…
$ cvar   &lt;chr&gt; "tmmn", "tmmn", "tmmn", "tmmn", "tmmn", "tmmn", "tmmn", "tmmn",…
$ temp_f [degF] 32.45 [degF], 30.11 [degF], 32.09 [degF], 39.11 [degF], 32.27 …</code></pre>
</div>
</div>
</section><section id="growing-degree-days" class="level2" data-number="3.3"><h2 data-number="3.3" class="anchored" data-anchor-id="growing-degree-days">
<span class="header-section-number">3.3</span> Growing Degree Days</h2>
<p>Growing Degree Days (GDD) are a measure of accumulated heat starting from a specific date / event. You may wonder - what’s the point of tracking accumulated heat, given that it cools down every night? The answer is because many plants seem to keep track of accumulated heat units. Research has shown that many phenological events, like the emergence of fruit, are strongly correlated with accumulated heat, also known as thermal time. Insect phenology is likewise strongly correlated with heat units.</p>
<p>There are a few ways of computing GDD. <span class="citation" data-cites="parker_observed_2022">Parker et al. (<a href="references.html#ref-parker_observed_2022" role="doc-biblioref">2022</a>)</span> recommend the simple average method with a base temperature of 10 °C:</p>
<center>
<span class="math inline">\(GDD = (temp_{max} - temp_{min}) / 2 - temp_{base}\)</span>
</center>
<p>Negative GDD values are not biologically meaningful (i.e., plant development generally doesn’t go backwards), so negative GDD values are generally converted to 0 (i.e., Method 1 described by <span class="citation" data-cites="mcmaster_growing_1997">McMaster and Wilhelm (<a href="references.html#ref-mcmaster_growing_1997" role="doc-biblioref">1997</a>)</span>).</p>
<p>Computing daily GDD is fairly straight-forward. We just have to remember to zero-out negative GDD values:</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="op">(</span><span class="va">tbase_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html">set_units</a></span><span class="op">(</span><span class="fl">10</span>, <span class="va">degC</span><span class="op">)</span><span class="op">)</span>                           <span class="co">## base temp</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>10 [°C]</code></pre>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colusa_gdd_tbl</span> <span class="op">&lt;-</span> <span class="va">colusa_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>temp_c <span class="op">=</span> <span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html">set_units</a></span><span class="op">(</span><span class="va">temp_f</span>, <span class="va">degC</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>             <span class="co">## create a degC column</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">dt</span><span class="op">)</span>,                       <span class="co">## make min and max temps separate colums</span></span>
<span>              names_from <span class="op">=</span> <span class="va">cvar</span>, </span>
<span>              values_from <span class="op">=</span> <span class="va">temp_c</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>gdd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">tmmx</span><span class="op">+</span><span class="va">tmmn</span><span class="op">)</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span> <span class="op">-</span> <span class="va">tbase_c</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="co">## compute gdd as a numeric value</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>gdd <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html">if_else</a></span><span class="op">(</span><span class="va">gdd</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="fl">0</span>, <span class="va">gdd</span><span class="op">)</span><span class="op">)</span>                   <span class="co">## zero-out negative values</span></span>
<span></span>
<span><span class="va">colusa_gdd_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["year"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["dt"],"name":[2],"type":["date"],"align":["right"]},{"label":["tmmn"],"name":[3],"type":["units"],"align":["right"]},{"label":["tmmx"],"name":[4],"type":["units"],"align":["right"]},{"label":["gdd"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"2000","2":"2000-01-01","3":"0.25 [°C]","4":"12.75 [°C]","5":"0"},{"1":"2000","2":"2000-01-02","3":"-1.05 [°C]","4":"12.15 [°C]","5":"0"},{"1":"2000","2":"2000-01-03","3":"0.05 [°C]","4":"14.25 [°C]","5":"0"},{"1":"2000","2":"2000-01-04","3":"3.95 [°C]","4":"9.65 [°C]","5":"0"},{"1":"2000","2":"2000-01-05","3":"0.15 [°C]","4":"14.15 [°C]","5":"0"},{"1":"2000","2":"2000-01-06","3":"-1.35 [°C]","4":"12.65 [°C]","5":"0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><br></p>
<p>Applying GDD to predict crop development requires 1) a start date (also known as a biofix date), and 2) a crop phenology table. These are not shown here, but are not hard to apply (for an example see the <a href="https://ucanr-igis.shinyapps.io/pist_gdd/">Pistachio Nut Development Decision Support</a> tool).</p>
<p><br></p>
</section><section id="chill-accumulation" class="level2" data-number="3.4"><h2 data-number="3.4" class="anchored" data-anchor-id="chill-accumulation">
<span class="header-section-number">3.4</span> Chill Accumulation</h2>
<p>Chill accumulation is similar to growing degree days, but for cold. In other words, there are a few phenological events that appear to be strongly correlated with the accumulated amount of chill. An example of this is flowering for many tree crops. Apparently, the trees keep an internal ledger of how cold its been during the winter, and for how long. They use this internal record use to decide when it’s time to come out of their winter dormancy and start flowering. This mechanism probably evolved to help them avoid frost damage.</p>
<p>Researchers have looked at a number of ways to measure accumulated chill, and the one that does the best job at predicting phenology events is called Chill Portions (CP) <span class="citation" data-cites="luedeling_global_2011">(<a href="references.html#ref-luedeling_global_2011" role="doc-biblioref">Luedeling and Brown 2011</a>)</span>. The calculations are a bit complicated, but fortunately there’s a R-package that will compute chill portions. For more info, see <a href="https://ucanr-igis.github.io/caladaptr-res/notebooks/chill.nb.html">here</a>.</p>
<p><br></p>
</section><section id="frost-days" class="level2" data-number="3.5"><h2 data-number="3.5" class="anchored" data-anchor-id="frost-days">
<span class="header-section-number">3.5</span> Frost Days</h2>
<p>Frost Days (FD) are the number of days per year with minimum temperatures (Tn) ≤ 0 °C <span class="citation" data-cites="parker_observed_2022">(<a href="references.html#ref-parker_observed_2022" role="doc-biblioref">Parker et al. 2022</a>)</span>. They can be computed with:</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colusa_fd_tbl</span> <span class="op">&lt;-</span> <span class="va">colusa_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cvar</span> <span class="op">==</span> <span class="st">"tmmn"</span>, <span class="va">temp_f</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html">set_units</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">degC</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>fd <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">colusa_fd_tbl</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["year"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["fd"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"2000","2":"9"},{"1":"2001","2":"14"},{"1":"2002","2":"16"},{"1":"2003","2":"10"},{"1":"2004","2":"9"},{"1":"2005","2":"5"},{"1":"2006","2":"11"},{"1":"2007","2":"23"},{"1":"2008","2":"8"},{"1":"2009","2":"24"},{"1":"2010","2":"8"},{"1":"2011","2":"31"},{"1":"2012","2":"22"},{"1":"2013","2":"38"},{"1":"2014","2":"2"},{"1":"2015","2":"12"},{"1":"2016","2":"7"},{"1":"2017","2":"9"},{"1":"2018","2":"14"},{"1":"2019","2":"7"},{"1":"2020","2":"10"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><br></p>
</section><section id="last-spring-and-first-fall-freeze" class="level2" data-number="3.6"><h2 data-number="3.6" class="anchored" data-anchor-id="last-spring-and-first-fall-freeze">
<span class="header-section-number">3.6</span> Last Spring and First Fall Freeze</h2>
<p>The Last Spring Freeze (LSF) is defined as the last day of the calendar year prior to 30 June with a Tn ≤ 0 °C. Conversely the First Fall Freeze (FFF) is defined as the first day of the calendar year commencing 1 July with Tn ≤ 0 °C <span class="citation" data-cites="parker_observed_2022">(<a href="references.html#ref-parker_observed_2022" role="doc-biblioref">Parker et al. 2022</a>)</span>.</p>
<p>We can find the last freeze date by chaining together dplyr expressions that i) keep only ‘freeze days’ from January through June, ii) group the freeze days by year, and iii) taking the max date for each group:</p>
<div class="cell">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colusa_lf_tbl</span> <span class="op">&lt;-</span> <span class="va">colusa_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cvar</span> <span class="op">==</span> <span class="st">"tmmn"</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="fl">6</span>, <span class="va">temp_f</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html">set_units</a></span><span class="op">(</span><span class="fl">32</span>, <span class="va">degF</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>lf <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">colusa_lf_tbl</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["year"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["lf"],"name":[2],"type":["date"],"align":["right"]}],"data":[{"1":"2000","2":"2000-01-28"},{"1":"2001","2":"2001-04-10"},{"1":"2002","2":"2002-03-18"},{"1":"2003","2":"2003-02-08"},{"1":"2004","2":"2004-01-05"},{"1":"2005","2":"2005-01-30"},{"1":"2006","2":"2006-02-20"},{"1":"2007","2":"2007-03-01"},{"1":"2008","2":"2008-04-20"},{"1":"2009","2":"2009-03-23"},{"1":"2011","2":"2011-02-28"},{"1":"2012","2":"2012-03-23"},{"1":"2013","2":"2013-02-26"},{"1":"2014","2":"2014-02-04"},{"1":"2015","2":"2015-01-03"},{"1":"2016","2":"2016-01-01"},{"1":"2017","2":"2017-02-28"},{"1":"2018","2":"2018-03-05"},{"1":"2019","2":"2019-01-04"},{"1":"2020","2":"2020-01-04"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><br></p>
<p>Similarly, we can find the first fall freeze by keeping only dates from July - December where the temperature dipped below freezing, then taking the minimum date for each year:</p>
<div class="cell">
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colusa_fff_tbl</span> <span class="op">&lt;-</span> <span class="va">colusa_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cvar</span> <span class="op">==</span> <span class="st">"tmmn"</span>, <span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span> <span class="op">&gt;=</span> <span class="fl">7</span>, <span class="va">temp_f</span> <span class="op">&lt;=</span> <span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html">set_units</a></span><span class="op">(</span><span class="fl">32</span>, <span class="va">degF</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>fff <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">colusa_fff_tbl</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["year"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["fff"],"name":[2],"type":["date"],"align":["right"]}],"data":[{"1":"2000","2":"2000-11-12"},{"1":"2001","2":"2001-11-27"},{"1":"2002","2":"2002-12-23"},{"1":"2003","2":"2003-11-22"},{"1":"2004","2":"2004-11-29"},{"1":"2005","2":"2005-12-04"},{"1":"2006","2":"2006-11-28"},{"1":"2007","2":"2007-12-01"},{"1":"2008","2":"2008-12-10"},{"1":"2009","2":"2009-11-13"},{"1":"2010","2":"2010-11-23"},{"1":"2011","2":"2011-12-04"},{"1":"2012","2":"2012-12-15"},{"1":"2013","2":"2013-11-24"},{"1":"2015","2":"2015-11-25"},{"1":"2016","2":"2016-12-06"},{"1":"2017","2":"2017-12-11"},{"1":"2018","2":"2018-11-14"},{"1":"2019","2":"2019-11-24"},{"1":"2020","2":"2020-11-10"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><br></p>
</section><section id="freeze-free-season" class="level2" data-number="3.7"><h2 data-number="3.7" class="anchored" data-anchor-id="freeze-free-season">
<span class="header-section-number">3.7</span> Freeze-Free Season</h2>
<p>The Freeze-Free Season (FFS) is calculated as the difference between the LSF and FFF (FFF [minus] LSF) <span class="citation" data-cites="parker_observed_2022">(<a href="references.html#ref-parker_observed_2022" role="doc-biblioref">Parker et al. 2022</a>)</span>. Since we already calculated LSF and FFF, computing the Freeze-Free Season can be done with a simple table join:</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colusa_lf_fff_tbl</span> <span class="op">&lt;-</span> <span class="va">colusa_lf_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">left_join</a></span><span class="op">(</span><span class="va">colusa_fff_tbl</span>, by <span class="op">=</span> <span class="st">"year"</span><span class="op">)</span></span>
<span><span class="va">colusa_lf_fff_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["year"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["lf"],"name":[2],"type":["date"],"align":["right"]},{"label":["fff"],"name":[3],"type":["date"],"align":["right"]}],"data":[{"1":"2000","2":"2000-01-28","3":"2000-11-12"},{"1":"2001","2":"2001-04-10","3":"2001-11-27"},{"1":"2002","2":"2002-03-18","3":"2002-12-23"},{"1":"2003","2":"2003-02-08","3":"2003-11-22"},{"1":"2004","2":"2004-01-05","3":"2004-11-29"},{"1":"2005","2":"2005-01-30","3":"2005-12-04"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colusa_lf_fff_ffs_tbl</span> <span class="op">&lt;-</span> <span class="va">colusa_lf_fff_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ffs <span class="op">=</span> <span class="va">fff</span> <span class="op">-</span> <span class="va">lf</span><span class="op">)</span></span>
<span><span class="va">colusa_lf_fff_ffs_tbl</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["year"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["lf"],"name":[2],"type":["date"],"align":["right"]},{"label":["fff"],"name":[3],"type":["date"],"align":["right"]},{"label":["ffs"],"name":[4],"type":["drtn"],"align":["right"]}],"data":[{"1":"2000","2":"2000-01-28","3":"2000-11-12","4":"289 days"},{"1":"2001","2":"2001-04-10","3":"2001-11-27","4":"231 days"},{"1":"2002","2":"2002-03-18","3":"2002-12-23","4":"280 days"},{"1":"2003","2":"2003-02-08","3":"2003-11-22","4":"287 days"},{"1":"2004","2":"2004-01-05","3":"2004-11-29","4":"329 days"},{"1":"2005","2":"2005-01-30","3":"2005-12-04","4":"308 days"},{"1":"2006","2":"2006-02-20","3":"2006-11-28","4":"281 days"},{"1":"2007","2":"2007-03-01","3":"2007-12-01","4":"275 days"},{"1":"2008","2":"2008-04-20","3":"2008-12-10","4":"234 days"},{"1":"2009","2":"2009-03-23","3":"2009-11-13","4":"235 days"},{"1":"2011","2":"2011-02-28","3":"2011-12-04","4":"279 days"},{"1":"2012","2":"2012-03-23","3":"2012-12-15","4":"267 days"},{"1":"2013","2":"2013-02-26","3":"2013-11-24","4":"271 days"},{"1":"2014","2":"2014-02-04","3":"<NA>","4":"NA days"},{"1":"2015","2":"2015-01-03","3":"2015-11-25","4":"326 days"},{"1":"2016","2":"2016-01-01","3":"2016-12-06","4":"340 days"},{"1":"2017","2":"2017-02-28","3":"2017-12-11","4":"286 days"},{"1":"2018","2":"2018-03-05","3":"2018-11-14","4":"254 days"},{"1":"2019","2":"2019-01-04","3":"2019-11-24","4":"324 days"},{"1":"2020","2":"2020-01-04","3":"2020-11-10","4":"311 days"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><br></p>
</section><section id="tropical-nights-and-hot-days" class="level2" data-number="3.8"><h2 data-number="3.8" class="anchored" data-anchor-id="tropical-nights-and-hot-days">
<span class="header-section-number">3.8</span> Tropical Nights and Hot Days</h2>
<p>Tropical Nights (TRN) are calculated as the number of nights per year with Tn &gt; 20 °C (68 °F) <span class="citation" data-cites="parker_observed_2022">(<a href="references.html#ref-parker_observed_2022" role="doc-biblioref">Parker et al. 2022</a>)</span>. This can be computed with:</p>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colusa_tn_tbl</span> <span class="op">&lt;-</span> <span class="va">colusa_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cvar</span> <span class="op">==</span> <span class="st">"tmmn"</span>, <span class="va">temp_f</span> <span class="op">&gt;</span> <span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html">set_units</a></span><span class="op">(</span><span class="fl">20</span>, <span class="va">degC</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>tn <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">colusa_tn_tbl</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["year"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["tn"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"2000","2":"10"},{"1":"2001","2":"8"},{"1":"2002","2":"3"},{"1":"2003","2":"10"},{"1":"2004","2":"1"},{"1":"2005","2":"4"},{"1":"2006","2":"12"},{"1":"2007","2":"6"},{"1":"2008","2":"6"},{"1":"2009","2":"3"},{"1":"2011","2":"2"},{"1":"2012","2":"3"},{"1":"2013","2":"13"},{"1":"2015","2":"10"},{"1":"2017","2":"15"},{"1":"2018","2":"2"},{"1":"2019","2":"3"},{"1":"2020","2":"13"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><br></p>
<p>Hot Days (HD) are defined as when Tx &gt; 38 °C <span class="citation" data-cites="parker_observed_2022">(<a href="references.html#ref-parker_observed_2022" role="doc-biblioref">Parker et al. 2022</a>)</span>. The number of hot days per year can be computed with:</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colusa_hd_tbl</span> <span class="op">&lt;-</span> <span class="va">colusa_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cvar</span> <span class="op">==</span> <span class="st">"tmmx"</span>, <span class="va">temp_f</span> <span class="op">&gt;</span> <span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html">set_units</a></span><span class="op">(</span><span class="fl">38</span>, <span class="va">degC</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>hd <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">colusa_hd_tbl</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["year"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["hd"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"2000","2":"15"},{"1":"2001","2":"17"},{"1":"2002","2":"15"},{"1":"2003","2":"14"},{"1":"2004","2":"7"},{"1":"2005","2":"20"},{"1":"2006","2":"20"},{"1":"2007","2":"8"},{"1":"2008","2":"21"},{"1":"2009","2":"26"},{"1":"2010","2":"13"},{"1":"2011","2":"3"},{"1":"2012","2":"33"},{"1":"2013","2":"26"},{"1":"2014","2":"19"},{"1":"2015","2":"18"},{"1":"2016","2":"21"},{"1":"2017","2":"27"},{"1":"2018","2":"15"},{"1":"2019","2":"9"},{"1":"2020","2":"12"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><br></p>
</section><section id="extreme-heat-days" class="level2" data-number="3.9"><h2 data-number="3.9" class="anchored" data-anchor-id="extreme-heat-days">
<span class="header-section-number">3.9</span> Extreme Heat Days</h2>
<p>Extreme Heat Days (EHD) are the number of days per year with Tx &gt;98th percentile of summer (June-August) Tx for the 1981–2010 period <span class="citation" data-cites="parker_observed_2022">(<a href="references.html#ref-parker_observed_2022" role="doc-biblioref">Parker et al. 2022</a>)</span>. This is similar to HD, but with a threshold value based on the historic record. We can compute the 98th percentile of daily summertime highs with:</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colusa_ehd_thresh</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ucanr-igis.github.io/caladaptr/reference/ca_loc_pt.html">ca_loc_pt</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">122.159304</span>, <span class="fl">39.289291</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ucanr-igis.github.io/caladaptr/reference/ca_slug.html">ca_slug</a></span><span class="op">(</span><span class="st">"tmmx_day_gridmet"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ucanr-igis.github.io/caladaptr/reference/ca_years.html">ca_years</a></span><span class="op">(</span>start <span class="op">=</span> <span class="fl">1981</span>, end <span class="op">=</span> <span class="fl">2010</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ucanr-igis.github.io/caladaptr/reference/ca_getvals_tbl.html">ca_getvals_tbl</a></span><span class="op">(</span>quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">val</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span><span class="op">(</span><span class="fl">0.98</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://r-quantities.github.io/units/reference/units.html">set_units</a></span><span class="op">(</span><span class="va">degF</span><span class="op">)</span></span>
<span></span>
<span><span class="va">colusa_ehd_thresh</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>106.2176 [degF]</code></pre>
</div>
</div>
<p><br></p>
<p>Once we have that threshold, we can compute Extreme Heat Days with:</p>
<div class="cell">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colusa_ehd_tbl</span> <span class="op">&lt;-</span> <span class="va">colusa_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cvar</span> <span class="op">==</span> <span class="st">"tmmx"</span>, <span class="va">temp_f</span> <span class="op">&gt;</span> <span class="va">colusa_ehd_thresh</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>hd <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">colusa_ehd_tbl</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["year"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["hd"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"2001","2":"1"},{"1":"2002","2":"1"},{"1":"2003","2":"4"},{"1":"2005","2":"2"},{"1":"2006","2":"7"},{"1":"2007","2":"1"},{"1":"2008","2":"4"},{"1":"2009","2":"3"},{"1":"2010","2":"1"},{"1":"2012","2":"10"},{"1":"2013","2":"12"},{"1":"2014","2":"2"},{"1":"2015","2":"1"},{"1":"2017","2":"8"},{"1":"2018","2":"1"},{"1":"2019","2":"1"},{"1":"2020","2":"3"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><br></p>
</section><section id="heatwaves" class="level2" data-number="3.10"><h2 data-number="3.10" class="anchored" data-anchor-id="heatwaves">
<span class="header-section-number">3.10</span> Heatwaves</h2>
<p>Heatwave events (HW) are defined as 3+ consecutive days with Tx &gt; 98th percentile of 1981–2010 summer Tx (as in EHD) <span class="citation" data-cites="parker_observed_2022">(<a href="references.html#ref-parker_observed_2022" role="doc-biblioref">Parker et al. 2022</a>)</span>. Using the technique described in [Chapter 4 - Counting Consecutive Events][Counting Consecutive Events], we can compute the number of heatwaves per year.</p>
<ol type="1">
<li>Add a column for extreme heat day, then create a grouped tibble (by year):</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colusa_grpd_tbl</span> <span class="op">&lt;-</span> <span class="va">colusa_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="va">cvar</span> <span class="op">==</span> <span class="st">"tmmx"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>ehd <span class="op">=</span> <span class="va">temp_f</span> <span class="op">&gt;</span> <span class="va">colusa_ehd_thresh</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html">arrange</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">colusa_grpd_tbl</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 7,671
Columns: 5
Groups: year [21]
$ year   &lt;dbl&gt; 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 200…
$ dt     &lt;date&gt; 2000-01-01, 2000-01-02, 2000-01-03, 2000-01-04, 2000-01-05, 20…
$ cvar   &lt;chr&gt; "tmmx", "tmmx", "tmmx", "tmmx", "tmmx", "tmmx", "tmmx", "tmmx",…
$ temp_f [degF] 54.95 [degF], 53.87 [degF], 57.65 [degF], 49.37 [degF], 57.47 …
$ ehd    &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, …</code></pre>
</div>
</div>
<p><br></p>
<ol start="2" type="1">
<li>Create a function that we can pass to <code><a href="https://dplyr.tidyverse.org/reference/group_map.html">group_modify()</a></code>, will return the number of heatwaves per group (year):</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">num_hw</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data_tbl</span>, <span class="va">key_tbl</span>, <span class="va">num_days</span> <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">rle_lst</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rle.html">rle</a></span><span class="op">(</span><span class="va">data_tbl</span><span class="op">$</span><span class="va">ehd</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>num_hw <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">rle_lst</span><span class="op">$</span><span class="va">values</span> <span class="op">&amp;</span> <span class="va">rle_lst</span><span class="op">$</span><span class="va">lengths</span> <span class="op">&gt;=</span> <span class="va">num_days</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>&nbsp;</p>
<ol start="3" type="1">
<li>Apply the heatwave function to the grouped tibble:</li>
</ol>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colusa_hw_tbl</span> <span class="op">&lt;-</span> <span class="va">colusa_grpd_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_map.html">group_modify</a></span><span class="op">(</span>.f <span class="op">=</span> <span class="va">num_hw</span>, num_days <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">colusa_hw_tbl</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["year"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["num_hw"],"name":[2],"type":["int"],"align":["right"]}],"data":[{"1":"2000","2":"0"},{"1":"2001","2":"0"},{"1":"2002","2":"0"},{"1":"2003","2":"0"},{"1":"2004","2":"0"},{"1":"2005","2":"0"},{"1":"2006","2":"1"},{"1":"2007","2":"0"},{"1":"2008","2":"1"},{"1":"2009","2":"0"},{"1":"2010","2":"0"},{"1":"2011","2":"0"},{"1":"2012","2":"1"},{"1":"2013","2":"2"},{"1":"2014","2":"0"},{"1":"2015","2":"0"},{"1":"2016","2":"0"},{"1":"2017","2":"0"},{"1":"2018","2":"0"},{"1":"2019","2":"0"},{"1":"2020","2":"0"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><br></p>
</section><section id="diurnal-temperature-range" class="level2" data-number="3.11"><h2 data-number="3.11" class="anchored" data-anchor-id="diurnal-temperature-range">
<span class="header-section-number">3.11</span> Diurnal Temperature Range</h2>
<p>Diurnal Temperature Range (DTR) is the difference between daily Tx and Tn <span class="citation" data-cites="parker_observed_2022">(<a href="references.html#ref-parker_observed_2022" role="doc-biblioref">Parker et al. 2022</a>)</span>. Below we calculate DTR over 1 March to 1 November.</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">colusa_dtr_tbl</span> <span class="op">&lt;-</span> <span class="va">colusa_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html">filter</a></span><span class="op">(</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/month.html">month</a></span><span class="op">(</span><span class="va">dt</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html">%in%</a></span> <span class="fl">3</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">year</span>, <span class="va">dt</span><span class="op">)</span>, names_from <span class="op">=</span> <span class="va">cvar</span>, values_from <span class="op">=</span> <span class="va">temp_f</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dtr <span class="op">=</span> <span class="va">tmmx</span> <span class="op">-</span> <span class="va">tmmn</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">colusa_dtr_tbl</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["year"],"name":[1],"type":["dbl"],"align":["right"]},{"label":["dt"],"name":[2],"type":["date"],"align":["right"]},{"label":["tmmn"],"name":[3],"type":["units"],"align":["right"]},{"label":["tmmx"],"name":[4],"type":["units"],"align":["right"]},{"label":["dtr"],"name":[5],"type":["units"],"align":["right"]}],"data":[{"1":"2000","2":"2000-03-01","3":"35.69 [degF]","4":"62.69 [degF]","5":"27.00 [degF]"},{"1":"2000","2":"2000-03-02","3":"45.95 [degF]","4":"55.49 [degF]","5":"9.54 [degF]"},{"1":"2000","2":"2000-03-03","3":"36.59 [degF]","4":"68.63 [degF]","5":"32.04 [degF]"},{"1":"2000","2":"2000-03-04","3":"41.09 [degF]","4":"62.15 [degF]","5":"21.06 [degF]"},{"1":"2000","2":"2000-03-05","3":"46.31 [degF]","4":"55.49 [degF]","5":"9.18 [degF]"},{"1":"2000","2":"2000-03-06","3":"43.61 [degF]","4":"56.39 [degF]","5":"12.78 [degF]"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">colusa_dtr_tbl</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">year</span>, y <span class="op">=</span> <span class="va">dtr</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Diurnal Temperature Range, 2000-2020"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"Colusa, CA"</span>, </span>
<span>       caption <span class="op">=</span> <span class="st">"Dataset: gridMet. Temporal period: March - October"</span>,</span>
<span>       x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">"daily temperature range"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="03_simple-agroclim-metrics_files/figure-html/ggplot_colusa_dtr_tbl-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="reference-evapotranspiration" class="level2" data-number="3.12"><h2 data-number="3.12" class="anchored" data-anchor-id="reference-evapotranspiration">
<span class="header-section-number">3.12</span> Reference Evapotranspiration</h2>
<p>ETo is calculated following the FAO Penman–Monteith method <span class="citation" data-cites="allen_crop_1998">(<a href="references.html#ref-allen_crop_1998" role="doc-biblioref">Allen and United Nations 1998</a>)</span>. We calculate summer (June-August) average ETo for each year 1981–2020 for our analysis. ETo units are mm <span class="citation" data-cites="parker_observed_2022">(<a href="references.html#ref-parker_observed_2022" role="doc-biblioref">Parker et al. 2022</a>)</span>.</p>
<p style="font-size:150%; font-style:italic;">
</p>
<p>More coming soon…</p>



<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-allen_crop_1998" class="csl-entry" role="listitem">
Allen, R. G., and Food and Agriculture Organization of the United Nations, eds. 1998. <em>Crop Evapotranspiration: Guidelines for Computing Crop Water Requirements</em>. <span>FAO</span> Irrigation and Drainage Paper 56. Rome: Food; Agriculture Organization of the United Nations.
</div>
<div id="ref-luedeling_global_2011" class="csl-entry" role="listitem">
Luedeling, Eike, and Patrick H. Brown. 2011. <span>“A Global Analysis of the Comparability of Winter Chill Models for Fruit and Nut Trees.”</span> <em>International Journal of Biometeorology</em> 55 (3): 411–21. <a href="https://doi.org/10.1007/s00484-010-0352-y">https://doi.org/10.1007/s00484-010-0352-y</a>.
</div>
<div id="ref-mcmaster_growing_1997" class="csl-entry" role="listitem">
McMaster, G, and W Wilhelm. 1997. <span>“Growing Degree-Days: One Equation, Two Interpretations.”</span> <em>Agricultural and Forest Meteorology</em> 87 (4): 291–300. <a href="https://doi.org/10.1016/S0168-1923(97)00027-0">https://doi.org/10.1016/S0168-1923(97)00027-0</a>.
</div>
<div id="ref-parker_observed_2022" class="csl-entry" role="listitem">
Parker, Lauren E., Ning Zhang, John T. Abatzoglou, Steven M. Ostoja, and Tapan B. Pathak. 2022. <span>“Observed <span>Changes</span> in <span>Agroclimate</span> <span>Metrics</span> <span>Relevant</span> for <span>Specialty</span> <span>Crop</span> <span>Production</span> in <span>California</span>.”</span> <em>Agronomy</em> 12 (1): 205. <a href="https://doi.org/10.3390/agronomy12010205">https://doi.org/10.3390/agronomy12010205</a>.
</div>
</div>
</section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./02_weather-data.html" class="pagination-link" aria-label="Weather Data">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Weather Data</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./04_degday.html" class="pagination-link" aria-label="Degree Days">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Degree Days</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ucanr-igis/agroclimate-cookbook/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/ucanr-igis/agroclimate-cookbook/edit/main/03_simple-agroclim-metrics.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li></ul></div></div></div></footer></body></html>