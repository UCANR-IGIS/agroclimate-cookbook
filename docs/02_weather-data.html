<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>2&nbsp; Weather Data – AgroClimate Cookbook</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./03_simple-agroclim-metrics.html" rel="next">
<link href="./01_data-wrangling.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-364982630eef5352dd1537128a8ed5cb.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script type="application/json" class="js-hypothesis-config">
{
  "theme": "clean",
  "openSidebar": false
}
</script><script async="" src="https://hypothes.is/embed.js"></script><script>
  window.document.addEventListener("DOMContentLoaded", function (_event) {
    document.body.classList.add('hypothesis-enabled');
  });
</script><link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet">
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
</head>
<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./02_weather-data.html"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Weather Data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">AgroClimate Cookbook</a> 
        <div class="sidebar-tools-main">
    <a href="https://github.com/ucanr-igis/agroclimate-cookbook/" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_data-wrangling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Data Wrangling Methods</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_weather-data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Weather Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_simple-agroclim-metrics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Simple AgroClimate Metrics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_degday.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Degree Days</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_chill.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Chill</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_agroclimate-rasters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Agroclimate Rasters</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_modeled-climate-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Modeled Climate Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./08_climate-analogues.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">AgroClimate Analogues</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99_other.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Other Content, Future Work</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="4"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#weather-data-intro" id="toc-weather-data-intro" class="nav-link active" data-scroll-target="#weather-data-intro"><span class="header-section-number">2.1</span> Intro</a></li>
  <li>
<a href="#weather-data-sources" id="toc-weather-data-sources" class="nav-link" data-scroll-target="#weather-data-sources"><span class="header-section-number">2.2</span> Weather Data Sources</a>
  <ul>
<li><a href="#what-makes-weather-data-good-for-ag" id="toc-what-makes-weather-data-good-for-ag" class="nav-link" data-scroll-target="#what-makes-weather-data-good-for-ag"><span class="header-section-number">2.2.1</span> What Makes Weather Data Good for Ag?</a></li>
  <li>
<a href="#sec-weather-data-cimis-station" id="toc-sec-weather-data-cimis-station" class="nav-link" data-scroll-target="#sec-weather-data-cimis-station"><span class="header-section-number">2.2.2</span> CIMIS Station Data</a>
  <ul class="collapse">
<li><a href="#cimis-api" id="toc-cimis-api" class="nav-link" data-scroll-target="#cimis-api"><span class="header-section-number">2.2.2.1</span> CIMIS API</a></li>
  <li><a href="#import-cimis-daily-data" id="toc-import-cimis-daily-data" class="nav-link" data-scroll-target="#import-cimis-daily-data"><span class="header-section-number">2.2.2.2</span> Import CIMIS Daily Data</a></li>
  <li><a href="#cimis-hourly-data" id="toc-cimis-hourly-data" class="nav-link" data-scroll-target="#cimis-hourly-data"><span class="header-section-number">2.2.2.3</span> CIMIS Hourly Data</a></li>
  </ul>
</li>
  <li><a href="#synoptic" id="toc-synoptic" class="nav-link" data-scroll-target="#synoptic"><span class="header-section-number">2.2.3</span> Synoptic</a></li>
  <li><a href="#sec-weather-data-gridmet" id="toc-sec-weather-data-gridmet" class="nav-link" data-scroll-target="#sec-weather-data-gridmet"><span class="header-section-number">2.2.4</span> gridMet &amp; Prism</a></li>
  </ul>
</li>
  <li>
<a href="#sec-weather-data-cleaning-data" id="toc-sec-weather-data-cleaning-data" class="nav-link" data-scroll-target="#sec-weather-data-cleaning-data"><span class="header-section-number">2.3</span> Cleaning Weather Data</a>
  <ul>
<li><a href="#dealing-with-bad-measurements" id="toc-dealing-with-bad-measurements" class="nav-link" data-scroll-target="#dealing-with-bad-measurements"><span class="header-section-number">2.3.1</span> Dealing with bad measurements</a></li>
  <li><a href="#sec-weather-data-missing-data" id="toc-sec-weather-data-missing-data" class="nav-link" data-scroll-target="#sec-weather-data-missing-data"><span class="header-section-number">2.3.2</span> Missing data</a></li>
  </ul>
</li>
  <li>
<a href="#sec-weather-data-temp-res" id="toc-sec-weather-data-temp-res" class="nav-link" data-scroll-target="#sec-weather-data-temp-res"><span class="header-section-number">2.4</span> Changing the Temporal Resolution of Weather Data</a>
  <ul>
<li><a href="#short-to-long" id="toc-short-to-long" class="nav-link" data-scroll-target="#short-to-long"><span class="header-section-number">2.4.1</span> Short to Long</a></li>
  <li><a href="#interpolating-shorter-intervals" id="toc-interpolating-shorter-intervals" class="nav-link" data-scroll-target="#interpolating-shorter-intervals"><span class="header-section-number">2.4.2</span> Interpolating Shorter Intervals</a></li>
  </ul>
</li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/ucanr-igis/agroclimate-cookbook/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/ucanr-igis/agroclimate-cookbook/edit/main/02_weather-data.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><div class="quarto-title">
<h1 class="title"><span id="sec-weather-data" class="quarto-section-identifier"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Weather Data</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><div class="callout callout-style-default callout-note callout-titled" title="Chapter Overview and To Do (for co-authors)">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Chapter Overview and To Do (for co-authors)
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<ul>
<li><p>This chapter provides a short intro to weather station data, with code examples for importing station data.</p></li>
<li><p>The main goal of the chapter is to provide code recipes for importing, cleaning and saving weather data. The data files (csvs) generated by the examples in this chapter will be saved within the repo, for use in other chapters.</p></li>
<li><p>The general data wrangling techniques / R packages used in this chapter are discussed in <a href="01_data-wrangling.html" class="quarto-xref"><span>Chapter 1</span></a>. We do not need to repeat those here.</p></li>
<li><p>We do not plan to discuss weather variables in any detail. Most of the examples in this book use temperature and precipitation (because those are the most common inputs into agroclimate metrics). This can be expanded in the future. We can provide links to other resources for more info about weather data.</p></li>
<li><p>This chapter focuses on importing station data (i.e., tabular). Interpolted weather raster data will be covered in Chapter 6. Agroclimate rasters. Modeled weather data from climate models (also raster) will be covered in ch 7. modeled climate data.</p></li>
<li>
<p>Future topics</p>
<ul>
<li><p>cleaning weather data (filling in missing values, range checks)</p></li>
<li><p>see also <a href="https://ucanr-igis.github.io/agroclimR/slides/agclimr_slides01.html#(12)" class="uri">https://ucanr-igis.github.io/agroclimR/slides/agclimr_slides01.html#(12)</a></p></li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<section id="weather-data-intro" class="level2" data-number="2.1"><h2 data-number="2.1" class="anchored" data-anchor-id="weather-data-intro">
<span class="header-section-number">2.1</span> Intro</h2>
<p>Computing agroclimate metrics starts with weather data - a time series of variables such as temperature and precipitation. These could be based on actual measurements from a weather station, or generated from a weather model.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Computing agroclimate metrics from modeled weather data">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Computing agroclimate metrics from modeled weather data
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>It may seem surprising that agroclimate metrics can be computed from either observed (i.e., ‘real’) or modeled (i.e., computer generated) weather data. What does it mean, and why would someone want to, compute something like degree days with modeled data?</p>
<p>For the purposes of computation, the metrics don’t care where the data come from. If you give the degree day equation a record of temperature values, it will give you back the metric. It doesn’t care whether the data are ‘real’ or ‘made up’. But of course what you do with that metric depends a great deal on where the weather data came from.</p>
<p>Metrics computed from actual measurements, and metrics computed from weather models, are used for different purposes. If you’re a farmer, you probably wouldn’t want to schedule your irrigation based on the simulated weather from a climate model. Likewise, if you’re a water control engineer, you probably wouldn’t want to plan the size of your flood infrastructure for the next 50 years based solely on the weather from the past couple of years.</p>
<p>Each type of weather data has appropriate and inappropriate uses. But the good news is that agroclimate metrics are generally based on plant and insect physiology, so they work for all kinds of data - past, present, and future. A metric that predicts nut development for a particular cultivar today is still a pretty good guess for nut development rates in the past, as well as 50 years from now.</p>
</div>
</div>
</div>
<p>There are a few characteristics of weather data to be aware of:</p>
<p><strong>Variables</strong>. Weather data typically consists of one or more variables, such as temperature, precipitation, or solar radiation. Some variables are measured directly. Others may be based on models (such as evapotranspiration).</p>
<div class="callout callout-style-default callout-note callout-titled" title="CIMIS Weather Variables">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
CIMIS Weather Variables
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The weather variables recorded by weather stations in the CIMIS network (<a href="#sec-weather-data-cimis-station" class="quarto-xref"><span>Section 2.2.2</span></a> below) include:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">cimir</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cimir/man/cimis_items.html">cimis_items</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/pull.html">pull</a></span><span class="op">(</span><span class="va">Name</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Average Air Temperature"   "Maximum Air Temperature"  
 [3] "Minimum Air Temperature"   "Dew Point"                
 [5] "CIMIS ETo"                 "ASCE ETo"                 
 [7] "ASCE ETr"                  "Precipitation"            
 [9] "Average Relative Humidity" "Maximum Relative Humidity"
[11] "Minimum Relative Humidity" "Average Soil Temperature" 
[13] "Maximum Soil Temperature"  "Minimum Soil Temperature" 
[15] "Average Solar Radiation"   "Net Solar Radiation"      
[17] "Average Vapor Pressure"    "Maximum Vapor Pressure"   
[19] "Minimum Vapor Pressure"    "Wind East-North-East"     
[21] "Wind East-South-East"      "Wind North-North-East"    
[23] "Wind North-North-West"     "Wind Run"                 
[25] "Average Wind Speed"        "Wind South-South-East"    
[27] "Wind South-South-West"     "Wind West-North-West"     
[29] "Wind West-South-West"      "Air Temperature"          
[31] "Net Radiation"             "Relative Humidity"        
[33] "Resultant Wind"            "Soil Temperature"         
[35] "Solar Radiation"           "Vapor Pressure"           
[37] "Wind Direction"            "Wind Speed"               </code></pre>
</div>
</div>
</div>
</div>
</div>
<p><strong>Temporal resolution</strong>. The time resolution of weather data depends on the source. Measurements from a modern weather station could be recorded as often as every 5 minutes. That doesn’t necessarily mean you’ll have access to data every 5 minutes (which is generally overkill anyway), unless of course you manage the station. Organizations that run weather stations typically provide the data in hourly and/or daily time steps, depending on the needs of their customers. Older data are often only available as daily averages.</p>
<div class="callout callout-style-default callout-note callout-titled" title="Are more data always better?">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Are more data always better?
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>When it comes to weather data for computing agroclimate metrics, more is not necessarily better. Many agroclimate metrics, and more importantly the decision making models derived from those metrics, were developed based on daily data. Hence, even if you have 5-minute data, to use those decision support models that tell you for example when you can turn down the irrigation, you may have to resample the 5-minute data to daily averages anyway.</p>
<p>In general, try to download the data at the time interval needed for your application.</p>
<p>Some notable agroclimate metrics that really require hourly data are chill portions and growing degree hours. Changing the time resolution of data is discussed in <a href="#sec-weather-data-temp-res" class="quarto-xref"><span>Section 2.4</span></a> below.</p>
</div>
</div>
</div>
</section><section id="weather-data-sources" class="level2" data-number="2.2"><h2 data-number="2.2" class="anchored" data-anchor-id="weather-data-sources">
<span class="header-section-number">2.2</span> Weather Data Sources</h2>
<section id="what-makes-weather-data-good-for-ag" class="level3" data-number="2.2.1"><h3 data-number="2.2.1" class="anchored" data-anchor-id="what-makes-weather-data-good-for-ag">
<span class="header-section-number">2.2.1</span> What Makes Weather Data Good for Ag?</h3>
<p>Not all weather data are created equal. If you’re interested in agroclimate metrics, you should look for a weather data source that reflects weather conditions at your farm or field site. This is probably not going to be the station on top of the TV building in the city, nor is it probably going to be the weather station out on a runway at the international airport.</p>
<p>In general, for agricultural applications closer is better. A station 40 miles away may reflect the same general patterns, but the differences in absolute values could be important, particularly if the station is at a higher elevation or closer to water or mountains.</p>
<p>Ideally the measurements also taken at the same height where the plant (or insects) are located. This is particularly an issue for tree crops, where temperature and humidity conditions in the orchard may differ from measurements in an open field.</p>
<p>Below, we give examples of weather data that is suited for agriculture.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Best Practices for Importing Weather Data ">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Best Practices for Importing Weather Data
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li>Date columns should be converted to R <code>Date</code> class<br>
</li>
<li>Date-time columns should be saved as R <code>POSIXct</code> objects, with the timezone assigned (local time is generally preferable)<br>
</li>
<li>Units should be indicated in column names, accompanying metadata, or by saving values as a <code>units</code> object.</li>
</ol>
</div>
</div>
</section><section id="sec-weather-data-cimis-station" class="level3" data-number="2.2.2"><h3 data-number="2.2.2" class="anchored" data-anchor-id="sec-weather-data-cimis-station">
<span class="header-section-number">2.2.2</span> CIMIS Station Data</h3>
<p><a href="https://cimis.water.ca.gov/">CIMIS</a> is a network of about 150 weather stations in California (<a href="https://cimis.water.ca.gov/Stations.aspx">map</a>), operated by the CA Dept. of Water Resources. The network was established to inform irrigation management, hence the stations are mostly in agricultural regions.</p>
<p>CIMIS stations are a bit different from other networks in that:</p>
<ol type="i">
<li><p>stations are located on grass fields (a golf course would be a perfect place for a CIMIS station)</p></li>
<li><p>the stations record evapotranspiration (actually, modeled evapotranspiration) as one of the ‘weather’ variables</p></li>
</ol>
<p>They do this because the ‘reference’ evapotranspiration coming off the grass can be used to estimate evapotranspiration of various crops (by multiplying the reference ET by coefficients determined from research). In turn, the estimated crop ET can be used to compute the water replenishment needs.</p>
<p>CIMIS data are widely used for many other agricultural applications as well. It is a popular dataset in part because its freely available and can be accessed through the CIMIS website as well as an API.</p>
<section id="cimis-api" class="level4" data-number="2.2.2.1"><h4 data-number="2.2.2.1" class="anchored" data-anchor-id="cimis-api">
<span class="header-section-number">2.2.2.1</span> CIMIS API</h4>
<p>To import CIMIS data into R via the API, you can use the <a href="https://hydroecology.net/cimir/">cimir</a> package <span class="citation" data-cites="R-cimir">(<a href="references.html#ref-R-cimir" role="doc-biblioref">Koohafkan 2021</a>)</span>. You’ll also need:</p>
<ul>
<li><p>a CIMIS API key (which you can get by creating a free CIMIS account <a href="https://et.water.ca.gov/">here</a>)</p></li>
<li><p>the id number(s) of the weather station(s) of interest (which you can find on the <a href="https://cimis.water.ca.gov/Stations.aspx">CIMIS website</a>)</p></li>
<li><p>the abbreviated names of weather variables (see <code><a href="https://rdrr.io/pkg/cimir/man/cimis_items.html">cimis_items()</a></code>)</p></li>
</ul>
<p><a href="https://hydroecology.net/cimir/">cimir</a> provides R functions to import data using the CIMIS API. The main download function is <code><a href="https://rdrr.io/pkg/cimir/man/cimis_data.html">cimir::cimis_data()</a></code>, which can be used to download a range of weather variables (depending on the <code>items</code> argument) at both daily and hourly intervals.</p>
</section><section id="import-cimis-daily-data" class="level4" data-number="2.2.2.2"><h4 data-number="2.2.2.2" class="anchored" data-anchor-id="import-cimis-daily-data">
<span class="header-section-number">2.2.2.2</span> Import CIMIS Daily Data</h4>
<p>Below, we’ll download one year of daily data for CIMIS Station 227 (located in Plymouth, Amador County). We begin by loading the packages we’ll be using for data wrangling:</p>
<div class="cell">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lubridate.tidyverse.org">lubridate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://stringr.tidyverse.org">stringr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://readr.tidyverse.org">readr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://lobstr.r-lib.org/">lobstr</a></span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Below, we’ll use <code><a href="https://rdrr.io/pkg/cimir/man/cimis_data.html">cimis_data()</a></code> to get daily precipitation and temperature:</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mkoohafkan/cimir">cimir</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Step 1. Load my cimis key</span></span>
<span><span class="va">my_cimis_key</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"MY_CIMIS_KEY"</span><span class="op">)</span></span>
<span><span class="fu">cimir</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cimir/man/set_key.html">set_key</a></span><span class="op">(</span><span class="va">my_cimis_key</span><span class="op">)</span></span>
<span></span>
<span><span class="co">### Query CIMIS data (Plymouth station #227)</span></span>
<span><span class="va">cim_ply_lng_tbl</span> <span class="op">&lt;-</span> <span class="fu">cimir</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/cimir/man/cimis_data.html">cimis_data</a></span><span class="op">(</span>targets <span class="op">=</span> <span class="fl">227</span>, </span>
<span>                                     start.date <span class="op">=</span> <span class="st">"2023-01-01"</span>, </span>
<span>                                     end.date <span class="op">=</span> <span class="st">"2023-12-31"</span>,</span>
<span>                                     measure.unit <span class="op">=</span> <span class="st">"E"</span>,</span>
<span>                                     items <span class="op">=</span> <span class="st">"day-precip,day-air-tmp-max,day-air-tmp-min"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">cim_ply_lng_tbl</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["Name"],"name":[1],"type":["chr"],"align":["left"]},{"label":["Type"],"name":[2],"type":["chr"],"align":["left"]},{"label":["Owner"],"name":[3],"type":["chr"],"align":["left"]},{"label":["Date"],"name":[4],"type":["date"],"align":["right"]},{"label":["Julian"],"name":[5],"type":["int"],"align":["right"]},{"label":["Station"],"name":[6],"type":["chr"],"align":["left"]},{"label":["Standard"],"name":[7],"type":["chr"],"align":["left"]},{"label":["ZipCodes"],"name":[8],"type":["chr"],"align":["left"]},{"label":["Scope"],"name":[9],"type":["chr"],"align":["left"]},{"label":["Item"],"name":[10],"type":["chr"],"align":["left"]},{"label":["Value"],"name":[11],"type":["dbl"],"align":["right"]},{"label":["Qc"],"name":[12],"type":["chr"],"align":["left"]},{"label":["Unit"],"name":[13],"type":["chr"],"align":["left"]}],"data":[{"1":"cimis","2":"station","3":"water.ca.gov","4":"2023-01-01","5":"1","6":"227","7":"english","8":"95669, 95629, 95685","9":"daily","10":"DayAirTmpMax","11":"57.70","12":"","13":"(F)"},{"1":"cimis","2":"station","3":"water.ca.gov","4":"2023-01-01","5":"1","6":"227","7":"english","8":"95669, 95629, 95685","9":"daily","10":"DayAirTmpMin","11":"34.60","12":"","13":"(F)"},{"1":"cimis","2":"station","3":"water.ca.gov","4":"2023-01-01","5":"1","6":"227","7":"english","8":"95669, 95629, 95685","9":"daily","10":"DayPrecip","11":"0.00","12":"","13":"(in)"},{"1":"cimis","2":"station","3":"water.ca.gov","4":"2023-01-02","5":"2","6":"227","7":"english","8":"95669, 95629, 95685","9":"daily","10":"DayAirTmpMax","11":"48.30","12":"","13":"(F)"},{"1":"cimis","2":"station","3":"water.ca.gov","4":"2023-01-02","5":"2","6":"227","7":"english","8":"95669, 95629, 95685","9":"daily","10":"DayAirTmpMin","11":"33.60","12":"","13":"(F)"},{"1":"cimis","2":"station","3":"water.ca.gov","4":"2023-01-02","5":"2","6":"227","7":"english","8":"95669, 95629, 95685","9":"daily","10":"DayPrecip","11":"0.59","12":"","13":"(in)"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><br></p>
<p>As can be seen above, <code><a href="https://rdrr.io/pkg/cimir/man/cimis_data.html">cimir::cimis_data()</a></code> returns a tibble in a ‘long’ format. R generally likes long data, but for our purposes of saving it as a CSV file, we’ll next use <code><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">tidyr::pivot_wider()</a></code> to reshape it in the more traditional wide format:</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cimis227_dly_tbl</span> <span class="op">&lt;-</span> <span class="va">cim_ply_lng_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">Station</span>, <span class="va">Date</span>, <span class="va">Item</span>, <span class="va">Value</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html">pivot_wider</a></span><span class="op">(</span>id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Station</span>, <span class="va">Date</span><span class="op">)</span>, names_from <span class="op">=</span> <span class="va">Item</span>, </span>
<span>                     values_from <span class="op">=</span> <span class="va">Value</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>stn_id <span class="op">=</span> <span class="va">Station</span>, date <span class="op">=</span> <span class="va">Date</span>, tmax_f <span class="op">=</span> <span class="va">DayAirTmpMax</span>, tmin_f <span class="op">=</span> <span class="va">DayAirTmpMin</span>, </span>
<span>         precip_in <span class="op">=</span> <span class="va">DayPrecip</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">cimis227_dly_tbl</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["stn_id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["date"],"name":[2],"type":["date"],"align":["right"]},{"label":["tmax_f"],"name":[3],"type":["dbl"],"align":["right"]},{"label":["tmin_f"],"name":[4],"type":["dbl"],"align":["right"]},{"label":["precip_in"],"name":[5],"type":["dbl"],"align":["right"]}],"data":[{"1":"227","2":"2023-01-01","3":"57.7","4":"34.6","5":"0.00"},{"1":"227","2":"2023-01-02","3":"48.3","4":"33.6","5":"0.59"},{"1":"227","2":"2023-01-03","3":"51.6","4":"39.6","5":"0.03"},{"1":"227","2":"2023-01-04","3":"63.5","4":"41.4","5":"0.27"},{"1":"227","2":"2023-01-05","3":"54.3","4":"44.0","5":"1.21"},{"1":"227","2":"2023-01-06","3":"56.1","4":"38.6","5":"0.00"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><br></p>
<p>Finally, we can save the tibble to disk:</p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">cimis227_dly_tbl</span>, file <span class="op">=</span> <span class="st">"./data/cimis227_dly.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Code to import the daily data CSV file">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code to import the daily data CSV file
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>To use these data in examples, you can import the CSV file with either of the following:</p>
<p>Import from online (works from anywhere):</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cimis227_dly_tbl</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/UCANR-IGIS/agroclimate-cookbook/main/data/cimis227_dly.csv"</span>, </span>
<span>                                   col_types <span class="op">=</span> <span class="st">"cDddd"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>If you are working in the RStudio project for this e-book (e.g., authors), use:</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cimis227_dly_tbl</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"./data/cimis227_dly.csv"</span>, </span>
<span>                                   col_types <span class="op">=</span> <span class="st">"cDddd"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p><br></p>
<p><strong>Visualize daily temperature</strong></p>
<div class="cell">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">cimis227_dly_tbl</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">tmin_f</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="cn">NULL</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"temp (F)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Minimum Daily Temperature"</span>,</span>
<span>       subtitle <span class="op">=</span> <span class="st">"CIMIS Station #227 - Plymouth"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure"><p><img src="02_weather-data_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section><section id="cimis-hourly-data" class="level4" data-number="2.2.2.3"><h4 data-number="2.2.2.3" class="anchored" data-anchor-id="cimis-hourly-data">
<span class="header-section-number">2.2.2.3</span> CIMIS Hourly Data</h4>
<p>CIMIS stations record measurements hourly. You can import hourly data with <code>cimir</code>, but the maximum number of records you can get from the API in one call is 1750 (about 5 months of data if you’re getting two variables every hour). Thus if you wanted an entire year of hourly data, you would have to make multiple calls for shorter periods and stack them together.</p>
<p>An alternative way to download hourly data is to use the <a href="https://cimis.water.ca.gov/WSNReportCriteria.aspx">CIMIS Station Reports</a> tool on the CIMIS website. This tool allows you to specify station(s), start and end date(s), and weather variables. You can then get the data as a web report, csv, xml, or pdf.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Sign-in before generating CIMIS Station reports">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Sign-in before generating CIMIS Station reports
</div>
</div>
<div class="callout-body-container callout-body">
<p>To get the most options with CIMIS Station Reports, be sure to be logged-in with your CIMIS account. If you’re not logged in, you can still create station reports, but you’ll be limited to a few preset “limited reports”, which only go back 7 days and are only available to view in your browser.</p>
</div>
</div>
<p>Below, we’ll import a CIMIS Station Report containing one year of hourly air temperature and precipitation measurements for CIMIS station 227 - Plymouth (Amador County).</p>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">station_report_fn</span> <span class="op">&lt;-</span> <span class="st">"./data/cimis_plymouth_station-report-2023.csv"</span></span>
<span></span>
<span><span class="co">## Import the CSV file using readr and dplyr</span></span>
<span><span class="va">cim_plymouth_hourly_tbl</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="va">station_report_fn</span>,</span>
<span>                                           col_types <span class="op">=</span> <span class="st">"ncccccdcdc"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html">rename</a></span><span class="op">(</span>stn_id <span class="op">=</span> <span class="va">`Stn Id`</span>, station_name <span class="op">=</span> <span class="va">`Stn Name`</span>, region <span class="op">=</span> <span class="va">`CIMIS Region`</span>,</span>
<span>         date_chr <span class="op">=</span> <span class="va">Date</span>, hour_pst <span class="op">=</span> <span class="va">`Hour (PST)`</span>, yday <span class="op">=</span> <span class="va">Jul</span>,</span>
<span>         precip_in <span class="op">=</span> <span class="va">`Precip (in)`</span>, precip_qc <span class="op">=</span> <span class="va">`qc...8`</span>,</span>
<span>         temp_f <span class="op">=</span> <span class="va">`Air Temp (F)`</span>, temp_qc <span class="op">=</span> <span class="va">`qc...10`</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>stn_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="va">stn_id</span><span class="op">)</span><span class="op">)</span>  <span class="co">## for consistency with other datasets</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>New names:
• `qc` -&gt; `qc...8`
• `qc` -&gt; `qc...10`</code></pre>
</div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">cim_plymouth_hourly_tbl</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["stn_id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["station_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["region"],"name":[3],"type":["chr"],"align":["left"]},{"label":["date_chr"],"name":[4],"type":["chr"],"align":["left"]},{"label":["hour_pst"],"name":[5],"type":["chr"],"align":["left"]},{"label":["yday"],"name":[6],"type":["chr"],"align":["left"]},{"label":["precip_in"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["precip_qc"],"name":[8],"type":["chr"],"align":["left"]},{"label":["temp_f"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["temp_qc"],"name":[10],"type":["chr"],"align":["left"]}],"data":[{"1":"227","2":"Plymouth","3":"Sierra Foothill","4":"1/1/2023","5":"0100","6":"001","7":"0","8":"NA","9":"46.3","10":"NA"},{"1":"227","2":"Plymouth","3":"Sierra Foothill","4":"1/1/2023","5":"0200","6":"001","7":"0","8":"NA","9":"46.5","10":"NA"},{"1":"227","2":"Plymouth","3":"Sierra Foothill","4":"1/1/2023","5":"0300","6":"001","7":"0","8":"NA","9":"46.4","10":"NA"},{"1":"227","2":"Plymouth","3":"Sierra Foothill","4":"1/1/2023","5":"0400","6":"001","7":"0","8":"NA","9":"45.7","10":"NA"},{"1":"227","2":"Plymouth","3":"Sierra Foothill","4":"1/1/2023","5":"0500","6":"001","7":"0","8":"NA","9":"44.3","10":"NA"},{"1":"227","2":"Plymouth","3":"Sierra Foothill","4":"1/1/2023","5":"0600","6":"001","7":"0","8":"NA","9":"42.2","10":"NA"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><br></p>
<p>Next, we’ll create a cleaned-up version that we can save. First thing is to combine the Date and Hour columns into a R date-time class (POSIXct):</p>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cimis227_hrly_tbl</span> <span class="op">&lt;-</span> <span class="va">cim_plymouth_hourly_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>datetime <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">mdy_h</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="va">date_chr</span>, <span class="fu"><a href="https://rdrr.io/r/base/numeric.html">as.numeric</a></span><span class="op">(</span><span class="va">hour_pst</span><span class="op">)</span> <span class="op">/</span> <span class="fl">100</span><span class="op">)</span>, </span>
<span>                          tz <span class="op">=</span> <span class="st">"America/Los_Angeles"</span><span class="op">)</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: There was 1 warning in `mutate()`.
ℹ In argument: `datetime = mdy_h(paste(date_chr, as.numeric(hour_pst)/100), tz
  = "America/Los_Angeles")`.
Caused by warning:
!  1 failed to parse.</code></pre>
</div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">cimis227_hrly_tbl</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["stn_id"],"name":[1],"type":["chr"],"align":["left"]},{"label":["station_name"],"name":[2],"type":["chr"],"align":["left"]},{"label":["region"],"name":[3],"type":["chr"],"align":["left"]},{"label":["date_chr"],"name":[4],"type":["chr"],"align":["left"]},{"label":["hour_pst"],"name":[5],"type":["chr"],"align":["left"]},{"label":["yday"],"name":[6],"type":["chr"],"align":["left"]},{"label":["precip_in"],"name":[7],"type":["dbl"],"align":["right"]},{"label":["precip_qc"],"name":[8],"type":["chr"],"align":["left"]},{"label":["temp_f"],"name":[9],"type":["dbl"],"align":["right"]},{"label":["temp_qc"],"name":[10],"type":["chr"],"align":["left"]},{"label":["datetime"],"name":[11],"type":["dttm"],"align":["right"]}],"data":[{"1":"227","2":"Plymouth","3":"Sierra Foothill","4":"1/1/2023","5":"0100","6":"001","7":"0","8":"NA","9":"46.3","10":"NA","11":"2023-01-01 01:00:00"},{"1":"227","2":"Plymouth","3":"Sierra Foothill","4":"1/1/2023","5":"0200","6":"001","7":"0","8":"NA","9":"46.5","10":"NA","11":"2023-01-01 02:00:00"},{"1":"227","2":"Plymouth","3":"Sierra Foothill","4":"1/1/2023","5":"0300","6":"001","7":"0","8":"NA","9":"46.4","10":"NA","11":"2023-01-01 03:00:00"},{"1":"227","2":"Plymouth","3":"Sierra Foothill","4":"1/1/2023","5":"0400","6":"001","7":"0","8":"NA","9":"45.7","10":"NA","11":"2023-01-01 04:00:00"},{"1":"227","2":"Plymouth","3":"Sierra Foothill","4":"1/1/2023","5":"0500","6":"001","7":"0","8":"NA","9":"44.3","10":"NA","11":"2023-01-01 05:00:00"},{"1":"227","2":"Plymouth","3":"Sierra Foothill","4":"1/1/2023","5":"0600","6":"001","7":"0","8":"NA","9":"42.2","10":"NA","11":"2023-01-01 06:00:00"}],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<div class="callout callout-style-default callout-caution callout-titled" title="Daylight Savings Time">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Daylight Savings Time
</div>
</div>
<div class="callout-body-container callout-body">
<p>When you’re switching the time zone of hourly data, you might get a parsing error if the time period includes the night when daylight savings time starts or ends.</p>
<p>The problem occurs because local time takes into account daylight savings. This is normally a good thing. However when the clock ‘falls back’, an entire hour of UTC time gets mapped onto the same local time. Similiarly on the night when you jump forward, 2:00am doesn’t exist in local time.</p>
<p>The workaround is to keep your data in UTC, or just ignore the warning.</p>
</div>
</div>
<p><br></p>
<p>Lastly, we can save the data as a csv file:</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Saving date-times in CSV files">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Saving date-times in CSV files
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>To save date-time values in CSV files (which are just text), a good practice is to format it in ISO8601 format, which is a well-established open standard for formatting time values as text, including timezone.</p>
<p>lubridate provides a function <code><a href="https://lubridate.tidyverse.org/reference/format_ISO8601.html">format_ISO8601()</a></code> which makes this easy. The <code>usetz</code> argument appends the time offset from UTC, which import functions can use to figure out the time zone.</p>
<div class="cell">
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/format_ISO8601.html">format_ISO8601</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html">Sys.time</a></span><span class="op">(</span><span class="op">)</span>, usetz <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "2025-12-11T08:04:33-0800"</code></pre>
</div>
</div>
<p>You can import date-times formatted as ISO8601 back into R using <code><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">lubridate::ymd_hms()</a></code>.</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cimis227_hrly_tbl</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dt <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/format_ISO8601.html">format_ISO8601</a></span><span class="op">(</span><span class="va">datetime</span>, usetz <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">stn_id</span>, <span class="va">dt</span>, <span class="va">temp_f</span>, <span class="va">precip_in</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="st">"./data/cimis227_hrly.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Code to import the hourly data CSV file">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-10-contents" aria-controls="callout-10" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code to import the hourly data CSV file
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-10" class="callout-10-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>To import these data into R, you can run one of the following:</p>
<p>Import from online (works from anywhere):</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cimis227_hrly_tbl</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/UCANR-IGIS/agroclimate-cookbook/main/data/cimis227_hrly.csv"</span>, col_types <span class="op">=</span> <span class="st">"ccdd"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dt <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="va">dt</span>, tz <span class="op">=</span> <span class="st">"America/Los_Angeles"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>If you are working in the RStudio project for this e-book (e.g., authors):</p>
<div class="cell">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">cimis227_hrly_tbl</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"./data/cimis227_hrly.csv"</span>, col_types <span class="op">=</span> <span class="st">"ccdd"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dt <span class="op">=</span> <span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="va">dt</span>, tz <span class="op">=</span> <span class="st">"America/Los_Angeles"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p><br></p>
</section></section><section id="synoptic" class="level3" data-number="2.2.3"><h3 data-number="2.2.3" class="anchored" data-anchor-id="synoptic">
<span class="header-section-number">2.2.3</span> Synoptic</h3>
<p><a href="https://synopticdata.com/">Synoptic</a> is an aggregator of weather data. The company grew out of a university project, and is now a public benefit corporation that offers access to weather data from over 140,000 weather stations across the USA. A notable feature of Synoptic is that they are not just a search engine. They actually host copies of the data and make them available to their customers thru their website and an API.</p>
<p>Synoptic hosts data from over 320 <a href="https://demos.synopticdata.com/providers/index.html">weather station networks</a>, including several networks designed to support agriculture. To get an API key, sign-up for an account. The free account allows you to download historical data up to one year old.</p>
<p>Below, we’ll use a free account to get 4 months of data (March-June, 2023) for the <a href="https://viewer.synopticdata.com/map/data/now/air-temperature/CPOSD/#stationdensity=0&amp;map=14.63/32.59881/-116.48996">Campo</a> weather station in San Diego County. This station is managed by Western Weather Group on behalf of San Diego Gas and Electric.</p>
<p>There is no R package that provides functions to query the Synoptic API. But the API is well documented so we can use the <a href="https://httr2.r-lib.org/">httr2</a> package to make a call and parse the results.</p>
<p>First, let’s look at the metadata for this station:</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://httr2.r-lib.org">httr2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Load token</span></span>
<span><span class="va">my_public_token</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html">Sys.getenv</a></span><span class="op">(</span><span class="st">"MY_SYNOPTIC_PUBLIC_TOKEN"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## You have to know the station id.</span></span>
<span><span class="co">## Campo station ID: CPOSD</span></span>
<span></span>
<span><span class="va">campo_meta_url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span></span>
<span>  <span class="st">"https://api.synopticdata.com/v2/stations/metadata?"</span>,</span>
<span>  <span class="st">"&amp;token="</span>, <span class="va">my_public_token</span>,</span>
<span>  <span class="st">"&amp;complete=1"</span>, </span>
<span>  <span class="st">"&amp;sensorvars=1"</span>,</span>
<span>  <span class="st">"&amp;stid=CPOSD"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">campo_meta_lst</span> <span class="op">&lt;-</span> <span class="va">campo_meta_url</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://httr2.r-lib.org/reference/request.html">request</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform.html">req_perform</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html">resp_body_json</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">lobstr</span><span class="fu">::</span><span class="fu"><a href="https://lobstr.r-lib.org/reference/tree.html">tree</a></span><span class="op">(</span><span class="va">campo_meta_lst</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;list&gt;
├─STATION: &lt;list&gt;
│ └─&lt;list&gt;
│   ├─ID: "28759"
│   ├─STID: "CPOSD"
│   ├─NAME: "Campo"
│   ├─ELEVATION: "2433.0"
│   ├─LATITUDE: "32.59898"
│   ├─LONGITUDE: "-116.49292"
│   ├─STATUS: "ACTIVE"
│   ├─MNET_ID: "139"
│   ├─STATE: "CA"
│   ├─COUNTRY: "US"
│   ├─TIMEZONE: "America/Los_Angeles"
│   ├─ELEV_DEM: "2437.7"
│   ├─NWSZONE: "CA058"
│   ├─NWSFIREZONE: "SGX258"
│   ├─GACC: "SOCC"
│   ├─SHORTNAME: "SDGE"
│   ├─LONGNAME: "San Diego Gas and Electric"
│   ├─URL: &lt;NULL&gt;
│   ├─PROGRAM: &lt;NULL&gt;
│   ├─CITATION: &lt;NULL&gt;
│   ├─SGID: "SC11"
│   ├─COUNTY: "San Diego"
│   ├─WIMS_ID: &lt;NULL&gt;
│   ├─CWA: "SGX"
│   ├─PERIOD_OF_RECORD: &lt;list&gt;
│   │ ├─start: "2010-01-02T00:00:00Z"
│   │ └─end: "2025-12-11T15:10:00Z"
│   ├─PROVIDERS: &lt;list&gt;
│   │ ├─&lt;list&gt;
│   │ │ ├─name: "San Diego Gas and Electric"
│   │ │ └─url: "http://www.sdge.com/index/"
│   │ └─&lt;list&gt;
│   │   ├─name: "Western Weather Group"
│   │   └─url: "http://www.westernweathergroup.com"
│   ├─SITING: &lt;list&gt;
│   ├─SENSOR_VARIABLES: &lt;list&gt;
│   │ ├─altimeter: &lt;list&gt;
│   │ │ └─altimeter_1: &lt;list&gt;
│   │ │   ├─position: "2.0"
│   │ │   ├─dimension: &lt;list&gt;
│   │ │   ├─summary: "altimeter_2_meter"
│   │ │   └─PERIOD_OF_RECORD: &lt;list&gt;
│   │ │     ├─start: "2010-01-02T00:00:00Z"
│   │ │     └─end: "2013-03-14T19:10:00Z"
│   │ ├─pressure: &lt;list&gt;
│   │ │ └─pressure_1: &lt;list&gt;
│   │ │   ├─position: "2.0"
│   │ │   ├─dimension: &lt;list&gt;
│   │ │   ├─summary: "pressure_2_meter"
│   │ │   └─PERIOD_OF_RECORD: &lt;list&gt;
│   │ │     ├─start: "2010-01-02T00:00:00Z"
│   │ │     └─end: "2013-03-01T22:20:00Z"
│   │ ├─air_temp: &lt;list&gt;
│   │ │ └─air_temp_1: &lt;list&gt;
│   │ │   ├─position: "2.0"
│   │ │   ├─dimension: &lt;list&gt;
│   │ │   ├─summary: "air_temp_2_meter"
│   │ │   └─PERIOD_OF_RECORD: &lt;list&gt;
│   │ │     ├─start: "2010-01-02T00:00:00Z"
│   │ │     └─end: "2025-12-11T15:10:00Z"
│   │ ├─relative_humidity: &lt;list&gt;
│   │ │ └─relative_humidity_1: &lt;list&gt;
│   │ │   ├─position: "2.0"
│   │ │   ├─dimension: &lt;list&gt;
│   │ │   ├─summary: "relative_humidity_2_meter"
│   │ │   └─PERIOD_OF_RECORD: &lt;list&gt;
│   │ │     ├─start: "2010-01-02T00:00:00Z"
│   │ │     └─end: "2025-12-11T15:10:00Z"
│   │ ├─wind_speed: &lt;list&gt;
│   │ │ └─wind_speed_1: &lt;list&gt;
│   │ │   ├─position: "6.1"
│   │ │   ├─dimension: &lt;list&gt;
│   │ │   ├─summary: "wind_speed_6.1_meter"
│   │ │   └─PERIOD_OF_RECORD: &lt;list&gt;
│   │ │     ├─start: "2010-01-02T00:00:00Z"
│   │ │     └─end: "2025-12-11T15:10:00Z"
│   │ ├─wind_direction: &lt;list&gt;
│   │ │ └─wind_direction_1: &lt;list&gt;
│   │ │   ├─position: "6.1"
│   │ │   ├─dimension: &lt;list&gt;
│   │ │   ├─summary: "wind_direction_6.1_meter"
│   │ │   └─PERIOD_OF_RECORD: &lt;list&gt;
│   │ │     ├─start: "2010-01-02T00:00:00Z"
│   │ │     └─end: "2025-12-11T15:10:00Z"
│   │ ├─wind_gust: &lt;list&gt;
│   │ │ └─wind_gust_1: &lt;list&gt;
│   │ │   ├─position: "6.1"
│   │ │   ├─dimension: &lt;list&gt;
│   │ │   ├─summary: "wind_gust_6.1_meter"
│   │ │   └─PERIOD_OF_RECORD: &lt;list&gt;
│   │ │     ├─start: "2010-01-02T00:00:00Z"
│   │ │     └─end: "2025-12-11T15:10:00Z"
│   │ ├─solar_radiation: &lt;list&gt;
│   │ │ └─solar_radiation_1: &lt;list&gt;
│   │ │   ├─position: "6.1"
│   │ │   ├─dimension: &lt;list&gt;
│   │ │   ├─summary: "solar_radiation_6.1_meter"
│   │ │   └─PERIOD_OF_RECORD: &lt;list&gt;
│   │ │     ├─start: "2010-01-02T00:00:00Z"
│   │ │     └─end: "2013-03-14T19:10:00Z"
│   │ └─volt: &lt;list&gt;
│   │   └─volt_1: &lt;list&gt;
│   │     ├─position: &lt;NULL&gt;
│   │     ├─dimension: &lt;list&gt;
│   │     ├─summary: "volt"
│   │     └─PERIOD_OF_RECORD: &lt;list&gt;
│   │       ├─start: "2019-09-12T19:43:00Z"
│   │       └─end: "2025-12-11T15:10:00Z"
│   ├─UNITS: &lt;list&gt;
│   │ ├─position: "m"
│   │ └─elevation: "ft"
│   ├─RESTRICTED: FALSE
│   └─RESTRICTED_METADATA: FALSE
└─SUMMARY: &lt;list&gt;
  ├─NUMBER_OF_OBJECTS: 1
  ├─RESPONSE_CODE: 1
  ├─RESPONSE_MESSAGE: "OK"
  ├─METADATA_QUERY_TIME: "2.3 ms"
  ├─METADATA_PARSE_TIME: "1.6 ms"
  ├─TOTAL_METADATA_TIME: "3.9 ms"
  ├─TOTAL_TIME: "3.9 ms"
  └─VERSION: "v2.30.3"</code></pre>
</div>
</div>
<p><br></p>
<p>To get weather data for a station, use the timeseries endpoint. Below we’ll get 4 months of data (March-June, 2023):</p>
<div class="cell">
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">start_dt_utc_chr</span> <span class="op">&lt;-</span> <span class="st">"202303010800"</span>    <span class="co">## must be in UTC (8 hours ahead)</span></span>
<span><span class="va">end_dt_utc_chr</span> <span class="op">&lt;-</span> <span class="st">"202307010700"</span>      <span class="co">## must be in UTC (7 hours ahead because of daylight savings)</span></span>
<span></span>
<span><span class="va">campo_ts_url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"https://api.synopticdata.com/v2/stations/timeseries?token="</span>, <span class="va">my_public_token</span>,</span>
<span>                    <span class="st">"&amp;stid=CPOSD"</span>,            <span class="co">## CIMIS Station #152</span></span>
<span>                    <span class="st">"&amp;vars=air_temp,relative_humidity,wind_speed"</span>,</span>
<span>                    <span class="st">"&amp;varsoperator=and"</span>,      <span class="co">## get all variables</span></span>
<span>                    <span class="st">"&amp;units=english"</span>,         <span class="co">## imperial units</span></span>
<span>                    <span class="st">"&amp;start="</span>, <span class="va">start_dt_utc_chr</span>,  <span class="co">## UTC time (+8)</span></span>
<span>                    <span class="st">"&amp;end="</span>, <span class="va">end_dt_utc_chr</span>,      <span class="co">## UTC time (+8)</span></span>
<span>                    <span class="st">"&amp;obtimezone=local"</span><span class="op">)</span>      <span class="co">## send back timestamps in local time</span></span>
<span></span>
<span><span class="co">## Create a request object, make the call, and convert the results to a list</span></span>
<span><span class="va">campo_ts_lst</span> <span class="op">&lt;-</span> <span class="va">campo_ts_url</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://httr2.r-lib.org/reference/request.html">request</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://httr2.r-lib.org/reference/req_perform.html">req_perform</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://httr2.r-lib.org/reference/resp_body_raw.html">resp_body_json</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The results include the timezone:</p>
<div class="cell">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">campo_ts_tz</span> <span class="op">&lt;-</span> <span class="va">campo_ts_lst</span><span class="op">$</span><span class="va">STATION</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">TIMEZONE</span></span>
<span><span class="va">campo_ts_tz</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>NULL</code></pre>
</div>
</div>
<p>To convert the list into a data frame, we first pull out the individual observations:</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Get the date times for the time series</span></span>
<span><span class="va">campo_ts_dt</span> <span class="op">&lt;-</span> <span class="va">campo_ts_lst</span><span class="op">$</span><span class="va">STATION</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">OBSERVATIONS</span><span class="op">$</span><span class="va">date_time</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span>tz <span class="op">=</span> <span class="va">campo_ts_tz</span><span class="op">)</span></span>
<span></span>
<span><span class="va">campo_ts_airtemp_lst</span> <span class="op">&lt;-</span> <span class="va">campo_ts_lst</span><span class="op">$</span><span class="va">STATION</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">OBSERVATIONS</span><span class="op">$</span><span class="va">air_temp_set_1</span></span>
<span><span class="va">campo_ts_airtemp_lst</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">campo_ts_airtemp_lst</span>, <span class="va">length</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">campo_ts_airtemp_vec</span> <span class="op">&lt;-</span> <span class="va">campo_ts_airtemp_lst</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">campo_ts_rh_lst</span> <span class="op">&lt;-</span> <span class="va">campo_ts_lst</span><span class="op">$</span><span class="va">STATION</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">OBSERVATIONS</span><span class="op">$</span><span class="va">relative_humidity_set_1</span></span>
<span><span class="va">campo_ts_rh_lst</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">campo_ts_rh_lst</span>, <span class="va">length</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">campo_ts_rh_vec</span> <span class="op">&lt;-</span> <span class="va">campo_ts_rh_lst</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">campo_ts_ws_lst</span> <span class="op">&lt;-</span> <span class="va">campo_ts_lst</span><span class="op">$</span><span class="va">STATION</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">OBSERVATIONS</span><span class="op">$</span><span class="va">wind_speed_set_1</span></span>
<span><span class="va">campo_ts_ws_lst</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span><span class="op">(</span><span class="va">campo_ts_ws_lst</span>, <span class="va">length</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span><span class="va">campo_ts_ws_vec</span> <span class="op">&lt;-</span> <span class="va">campo_ts_ws_lst</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now we have everything we need to build the tibble:</p>
<div class="cell">
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## Compute a tibble with the hourly values</span></span>
<span><span class="va">campo2023_tbl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html">tibble</a></span><span class="op">(</span>dt <span class="op">=</span> <span class="va">campo_ts_dt</span>,</span>
<span>                         date <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/date.html">date</a></span><span class="op">(</span><span class="va">campo_ts_dt</span><span class="op">)</span>,</span>
<span>                         airtemp <span class="op">=</span> <span class="va">campo_ts_airtemp_vec</span>,</span>
<span>                         wind_speed <span class="op">=</span> <span class="va">campo_ts_ws_vec</span>,</span>
<span>                         rh <span class="op">=</span> <span class="va">campo_ts_rh_vec</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">campo2023_tbl</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div data-pagedtable="false">
  <script data-pagedtable-source="" type="application/json">
{"columns":[{"label":["dt"],"name":[1],"type":["dttm"],"align":["right"]},{"label":["date"],"name":[2],"type":["date"],"align":["right"]},{"label":["airtemp"],"name":[3],"type":["lgl"],"align":["right"]},{"label":["wind_speed"],"name":[4],"type":["lgl"],"align":["right"]},{"label":["rh"],"name":[5],"type":["lgl"],"align":["right"]}],"data":[],"options":{"columns":{"min":{},"max":[10]},"rows":{"min":[10],"max":[10]},"pages":{}}}
  </script>
</div>
</div>
</div>
<p><br></p>
<p>Save as CSV:</p>
<div class="cell">
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html">write_csv</a></span><span class="op">(</span><span class="va">campo2023_tbl</span>, file <span class="op">=</span> <span class="st">"./data/campo2023.csv"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Code to import the Campo time series CSV file">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Code to import the Campo time series CSV file
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>To use these data in examples, you can import the CSV file with either of the following:</p>
<p>Import from online (works from anywhere):</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">campo2023_tbl</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"https://raw.githubusercontent.com/UCANR-IGIS/agroclimate-cookbook/main/data/campo2023.csv"</span>, </span>
<span>                                 col_types <span class="op">=</span> <span class="st">"cDddd"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dt <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="va">dt</span>, tz <span class="op">=</span> <span class="st">"America/Los_Angeles"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<p>If you are working in the RStudio project for this e-book (e.g., authors), use:</p>
<div class="cell">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">campo2023_tbl</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html">read_csv</a></span><span class="op">(</span><span class="st">"./data/campo2023.csv"</span>, </span>
<span>                                 col_types <span class="op">=</span> <span class="st">"cDddd"</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dt <span class="op">=</span> <span class="fu"><a href="https://lubridate.tidyverse.org/reference/ymd_hms.html">ymd_hms</a></span><span class="op">(</span><span class="va">dt</span>, tz <span class="op">=</span> <span class="st">"America/Los_Angeles"</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p><br></p>
</section><section id="sec-weather-data-gridmet" class="level3" data-number="2.2.4"><h3 data-number="2.2.4" class="anchored" data-anchor-id="sec-weather-data-gridmet">
<span class="header-section-number">2.2.4</span> gridMet &amp; Prism</h3>
<p>PRISM and gridMet are rasters of weather variables, interpolated from observed weather data.</p>
<p>gridMet is available via the Cal-Adapt API (up thru 2021?)</p>
<p>PRISM is available as NetCDF (I think). Only the 4k product is free.</p>
<p>Put these in <a href="06_agroclimate-rasters.html" class="quarto-xref"><span>Chapter 6</span></a> (will use <code>stars</code> to work with)</p>
<p><br></p>
</section></section><section id="sec-weather-data-cleaning-data" class="level2" data-number="2.3"><h2 data-number="2.3" class="anchored" data-anchor-id="sec-weather-data-cleaning-data">
<span class="header-section-number">2.3</span> Cleaning Weather Data</h2>
<section id="dealing-with-bad-measurements" class="level3" data-number="2.3.1"><h3 data-number="2.3.1" class="anchored" data-anchor-id="dealing-with-bad-measurements">
<span class="header-section-number">2.3.1</span> Dealing with bad measurements</h3>
<p>range checks</p>
</section><section id="sec-weather-data-missing-data" class="level3" data-number="2.3.2"><h3 data-number="2.3.2" class="anchored" data-anchor-id="sec-weather-data-missing-data">
<span class="header-section-number">2.3.2</span> Missing data</h3>
<p>see <a href="https://inresgb-lehre.iaas.uni-bonn.de/chillR_book/filling-gaps-in-temperature-records.html" class="uri">https://inresgb-lehre.iaas.uni-bonn.de/chillR_book/filling-gaps-in-temperature-records.html</a></p>
<p><br></p>
</section></section><section id="sec-weather-data-temp-res" class="level2" data-number="2.4"><h2 data-number="2.4" class="anchored" data-anchor-id="sec-weather-data-temp-res">
<span class="header-section-number">2.4</span> Changing the Temporal Resolution of Weather Data</h2>
<section id="short-to-long" class="level3" data-number="2.4.1"><h3 data-number="2.4.1" class="anchored" data-anchor-id="short-to-long">
<span class="header-section-number">2.4.1</span> Short to Long</h3>
<p>If you have timeseries data at short intervals (e.g.&nbsp;hourly), summarizing them by longer intervals (e.g., daily) is technically pretty straightforward using <code><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise()</a></code> from <code>dplyr</code>. However you have to think carefuly about which summary function is appropriate for the variable you’re interested in. The usual suspects are average, min, max.</p>
<div class="callout callout-style-default callout-important callout-titled" title="Getting the time zone right">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Getting the time zone right
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you’re summarizing hourly data (or shorter) to daily intervals, and you’re using the traditional definition of a ‘day’ as starting and ending at midnight, then you’ll want to make sure your data are in local time. Otherwise you’ll be computing 24-hour summaries that start and end at 2pm (if your station is in the western USA, for example).</p>
</div>
</div>
<p>TODO: Give an example of using dplyr to group hourly CIMIS data into daily. Compare with the daily CIMIS data.</p>
</section><section id="interpolating-shorter-intervals" class="level3" data-number="2.4.2"><h3 data-number="2.4.2" class="anchored" data-anchor-id="interpolating-shorter-intervals">
<span class="header-section-number">2.4.2</span> Interpolating Shorter Intervals</h3>
<p>Going from daily values to hourly values,is less straightforward and requires a model for the downscaling. Most (all) weather variables don’t vary linearly over the course of the day, nor do they vary consistently over the seasons.</p>
<p>For more info, see:</p>
<p><a href="https://inresgb-lehre.iaas.uni-bonn.de/chillR_book/making-hourly-temperatures.html" class="uri">https://inresgb-lehre.iaas.uni-bonn.de/chillR_book/making-hourly-temperatures.html</a></p>


<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list" style="display: none">
<div id="ref-R-cimir" class="csl-entry" role="listitem">
Koohafkan, Michael. 2021. <em>Cimir: Interface to the CIMIS Web API</em>. <a href="https://github.com/mkoohafkan/cimir">https://github.com/mkoohafkan/cimir</a>.
</div>
</div>
</section></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
            // target, if specified
            link.setAttribute("target", "_blank");
            if (link.getAttribute("rel") === null) {
              link.setAttribute("rel", "noopener");
            }
            // default icon
            link.classList.add("external");
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./01_data-wrangling.html" class="pagination-link" aria-label="Data Wrangling Methods">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Data Wrangling Methods</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./03_simple-agroclim-metrics.html" class="pagination-link" aria-label="Simple AgroClimate Metrics">
        <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Simple AgroClimate Metrics</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



<footer class="footer"><div class="nav-footer"><div class="nav-footer-center"><div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/ucanr-igis/agroclimate-cookbook/issues/new" class="toc-action"><i class="bi bi-github"></i>Report an issue</a></li><li><a href="https://github.com/ucanr-igis/agroclimate-cookbook/edit/main/02_weather-data.qmd" class="toc-action"><i class="bi empty"></i>Edit this page</a></li></ul></div></div></div></footer></body></html>