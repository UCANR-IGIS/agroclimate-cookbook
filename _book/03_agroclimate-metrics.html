<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>AgroClimate Community Cookbook - 3&nbsp; AgroClimate Metrics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./04_degday-chill.html" rel="next">
<link href="./02_metrics-methods.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-1.3.1/leaflet.js"></script>
<link href="site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="site_libs/proj4-2.6.2/proj4.min.js"></script>
<script src="site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-binding-2.2.0/leaflet.js"></script>
<script src="site_libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="site_libs/leaflet-providers-plugin-2.2.0/leaflet-providers-plugin.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./03_agroclimate-metrics.html"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">AgroClimate Metrics</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">AgroClimate Community Cookbook</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./01_weather-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Weather and Climate Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./02_metrics-methods.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Methods for Computing Metrics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./03_agroclimate-metrics.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">AgroClimate Metrics</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./04_degday-chill.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Degree Days</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./05_agroclimate-rasters.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Agroclimate Rasters</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./06_modeled-climate-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Modeled Climate Data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./07_climate-analogues.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">AgroClimate Analogues</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99_other.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Other Examples</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#load-packages" id="toc-load-packages" class="nav-link active" data-scroll-target="#load-packages"><span class="header-section-number">3.1</span> Load Packages</a></li>
  <li><a href="#fetch-some-data" id="toc-fetch-some-data" class="nav-link" data-scroll-target="#fetch-some-data"><span class="header-section-number">3.2</span> Fetch Some Data</a></li>
  <li><a href="#growing-degree-days" id="toc-growing-degree-days" class="nav-link" data-scroll-target="#growing-degree-days"><span class="header-section-number">3.3</span> Growing Degree Days</a></li>
  <li><a href="#chill-accumulation" id="toc-chill-accumulation" class="nav-link" data-scroll-target="#chill-accumulation"><span class="header-section-number">3.4</span> Chill Accumulation</a></li>
  <li><a href="#frost-days" id="toc-frost-days" class="nav-link" data-scroll-target="#frost-days"><span class="header-section-number">3.5</span> Frost Days</a></li>
  <li><a href="#last-spring-and-first-fall-freeze" id="toc-last-spring-and-first-fall-freeze" class="nav-link" data-scroll-target="#last-spring-and-first-fall-freeze"><span class="header-section-number">3.6</span> Last Spring and First Fall Freeze</a></li>
  <li><a href="#freeze-free-season" id="toc-freeze-free-season" class="nav-link" data-scroll-target="#freeze-free-season"><span class="header-section-number">3.7</span> Freeze-Free Season</a></li>
  <li><a href="#tropical-nights-and-hot-days" id="toc-tropical-nights-and-hot-days" class="nav-link" data-scroll-target="#tropical-nights-and-hot-days"><span class="header-section-number">3.8</span> Tropical Nights and Hot Days</a></li>
  <li><a href="#extreme-heat-days" id="toc-extreme-heat-days" class="nav-link" data-scroll-target="#extreme-heat-days"><span class="header-section-number">3.9</span> Extreme Heat Days</a></li>
  <li><a href="#heatwaves" id="toc-heatwaves" class="nav-link" data-scroll-target="#heatwaves"><span class="header-section-number">3.10</span> Heatwaves</a></li>
  <li><a href="#diurnal-temperature-range" id="toc-diurnal-temperature-range" class="nav-link" data-scroll-target="#diurnal-temperature-range"><span class="header-section-number">3.11</span> Diurnal Temperature Range</a></li>
  <li><a href="#reference-evapotranspiration" id="toc-reference-evapotranspiration" class="nav-link" data-scroll-target="#reference-evapotranspiration"><span class="header-section-number">3.12</span> Reference Evapotranspiration</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">AgroClimate Metrics</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<p><span class="citation" data-cites="parker_observed_2022">Parker et al. (<a href="references.html#ref-parker_observed_2022" role="doc-biblioref">2022</a>)</span> identify a dozen agroclimate metrics derived 100% from weather data and provide physiologically relevant information for growers. This chapter provides R code to compute most of these agroclimate metrics using historic observed data from Cal-Adapt.</p>
<section id="load-packages" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="load-packages"><span class="header-section-number">3.1</span> Load Packages</h2>
<p>As usual, we start by loading a bunch of packages into memory and specifying our preferences for conflicting function names:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(caladaptr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(units)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Set conflicted preferences:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(conflicted)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">conflict_prefer</span>(<span class="st">"filter"</span>, <span class="st">"dplyr"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">conflict_prefer</span>(<span class="st">"count"</span>, <span class="st">"dplyr"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="fu">conflict_prefer</span>(<span class="st">"select"</span>, <span class="st">"dplyr"</span>, <span class="at">quiet =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="fetch-some-data" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="fetch-some-data"><span class="header-section-number">3.2</span> Fetch Some Data</h2>
<p>To compute agroclimate metrics, we’ll first get 20 years of observed data from the gridMet dataset for a location in Colusa County in the Sacramento Valley.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>colusa_cap <span class="ot">&lt;-</span> <span class="fu">ca_loc_pt</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">122.159304</span>, <span class="fl">39.289291</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ca_slug</span>(<span class="fu">c</span>(<span class="st">"tmmn_day_gridmet"</span>, <span class="st">"tmmx_day_gridmet"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ca_years</span>(<span class="at">start =</span> <span class="dv">2000</span>, <span class="at">end =</span> <span class="dv">2020</span>) </span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>colusa_cap</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Cal-Adapt API Request
Location(s): 
  x: -122.159
  y: 39.289
Slug(s): tmmn_day_gridmet, tmmx_day_gridmet
Dates: 2000-01-01 to 2020-12-31
 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>colusa_cap <span class="sc">%&gt;%</span> <span class="fu">ca_preflight</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>General issues
 - none found
Issues for querying values
 - none found
Issues for downloading rasters
 - none found</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(colusa_cap)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">

<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-3c15e1f16e7acb9fc7a0" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-3c15e1f16e7acb9fc7a0">{"x":{"options":{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}}},"calls":[{"method":"createMapPane","args":["tmap401",401]},{"method":"addProviderTiles","args":["Esri.NatGeoWorldMap",null,"Esri.NatGeoWorldMap",{"minZoom":0,"maxZoom":18,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false,"pane":"tilePane"}]},{"method":"addCircleMarkers","args":[39.28929099999999,-122.159304,8.944271909999159,"X1","Query Location(s)",{"interactive":true,"className":"","pane":"tmap401","stroke":true,"color":"#666666","weight":1,"opacity":0.5,"fill":true,"fillColor":"#FF0000","fillOpacity":0.8},null,null,"<style> div.leaflet-popup-content {width:auto !important;overflow-y:auto; overflow-x:hidden;}<\/style><div style=\"max-height:25em;padding-right:0px;\"><table>\n\t\t\t   <thead><tr><th colspan=\"2\"><b>1<\/b><\/th><\/thead><\/tr><tr><td style=\"color: #888888;\"><nobr>id<\/nobr><\/td><td align=\"right\"><nobr>1<\/nobr><\/td><\/tr><\/table><\/div>",null,"1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addLayersControl","args":[[],"Query Location(s)",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]}],"limits":{"lat":[39.28929099999999,39.28929099999999],"lng":[-122.159304,-122.159304]},"fitBounds":[38.78929099999999,-122.659304,39.78929099999999,-121.659304,[]]},"evals":[],"jsHooks":[]}</script>
</div>
</div>
<p><br>
</p>
<p>Next we fetch the data. While we’re at it, we’ll add columns for the climate variable (based on the slug), year, and temperature in Fahrenheit:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>colusa_tbl <span class="ot">&lt;-</span> colusa_cap <span class="sc">%&gt;%</span> </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ca_getvals_tbl</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dt =</span> <span class="fu">as.Date</span>(dt),</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">year =</span> <span class="fu">year</span>(<span class="fu">as.Date</span>(dt)),</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">cvar =</span> <span class="fu">substr</span>(slug, <span class="dv">1</span>, <span class="dv">4</span>),</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">temp_f =</span> units<span class="sc">::</span><span class="fu">set_units</span>(val, degF)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(year, dt, cvar, temp_f)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(colusa_tbl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 15,342
Columns: 4
$ year   &lt;dbl&gt; 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 200…
$ dt     &lt;date&gt; 2000-01-01, 2000-01-02, 2000-01-03, 2000-01-04, 2000-01-05, 20…
$ cvar   &lt;chr&gt; "tmmn", "tmmn", "tmmn", "tmmn", "tmmn", "tmmn", "tmmn", "tmmn",…
$ temp_f [degF] 32.45 [degF], 30.11 [degF], 32.09 [degF], 39.11 [degF], 32.27 …</code></pre>
</div>
</div>
</section>
<section id="growing-degree-days" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="growing-degree-days"><span class="header-section-number">3.3</span> Growing Degree Days</h2>
<p>Growing Degree Days (GDD) are a measure of accumulated heat starting from a specific date / event. You may wonder - what’s the point of tracking accumulated heat, given that it cools down every night? The answer is because many plants seem to keep track of accumulated heat units. Research has shown that many phenological events, like the emergence of fruit, are strongly correlated with accumulated heat, also known as thermal time. Insect phenology is likewise strongly correlated with heat units.</p>
<p>There are a few ways of computing GDD. <span class="citation" data-cites="parker_observed_2022">Parker et al. (<a href="references.html#ref-parker_observed_2022" role="doc-biblioref">2022</a>)</span> recommend the simple average method with a base temperature of 10 °C:</p>
<center>
<span class="math inline">\(GDD = (temp_{max} - temp_{min}) / 2 - temp_{base}\)</span>
</center>
<p>Negative GDD values are not biologically meaningful (i.e., plant development generally doesn’t go backwards), so negative GDD values are generally converted to 0 (i.e., Method 1 described by <span class="citation" data-cites="mcmaster_growing_1997">McMaster and Wilhelm (<a href="references.html#ref-mcmaster_growing_1997" role="doc-biblioref">1997</a>)</span>).</p>
<p>Computing daily GDD is fairly straight-forward. We just have to remember to zero-out negative GDD values:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>(tbase_c <span class="ot">&lt;-</span> <span class="fu">set_units</span>(<span class="dv">10</span>, degC))                           <span class="do">## base temp</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>10 [°C]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>colusa_gdd_tbl <span class="ot">&lt;-</span> colusa_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">temp_c =</span> <span class="fu">set_units</span>(temp_f, degC)) <span class="sc">%&gt;%</span>             <span class="do">## create a degC column</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(year, dt),                       <span class="do">## make min and max temps separate colums</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>              <span class="at">names_from =</span> cvar, </span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>              <span class="at">values_from =</span> temp_c) <span class="sc">%&gt;%</span> </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gdd =</span> <span class="fu">as.numeric</span>(((tmmx<span class="sc">+</span>tmmn)<span class="sc">/</span><span class="dv">2</span>) <span class="sc">-</span> tbase_c)) <span class="sc">%&gt;%</span>  <span class="do">## compute gdd as a numeric value</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">gdd =</span> <span class="fu">if_else</span>(gdd <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">0</span>, gdd))                   <span class="do">## zero-out negative values</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>colusa_gdd_tbl <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
   year dt            tmmn  tmmx   gdd
  &lt;dbl&gt; &lt;date&gt;        [°C]  [°C] &lt;dbl&gt;
1  2000 2000-01-01  0.250  12.7      0
2  2000 2000-01-02 -1.05   12.2      0
3  2000 2000-01-03  0.0500 14.2      0
4  2000 2000-01-04  3.95    9.65     0
5  2000 2000-01-05  0.150  14.2      0
6  2000 2000-01-06 -1.35   12.6      0</code></pre>
</div>
</div>
<p><br>
</p>
<p>Applying GDD to predict crop development requires 1) a start date (also known as a biofix date), and 2) a crop phenology table. These are not shown here, but are not hard to apply (for an example see the <a href="https://ucanr-igis.shinyapps.io/pist_gdd/" target="_blank" rel="noopener">Pistachio Nut Development Decision Support</a> tool).</p>
<p><br>
</p>
</section>
<section id="chill-accumulation" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="chill-accumulation"><span class="header-section-number">3.4</span> Chill Accumulation</h2>
<p>Chill accumulation is similar to growing degree days, but for cold. In other words, there are a few phenological events that appear to be strongly correlated with the accumulated amount of chill. An example of this is flowering for many tree crops. Apparently, the trees keep an internal ledger of how cold its been during the winter, and for how long. They use this internal record use to decide when it’s time to come out of their winter dormancy and start flowering. This mechanism probably evolved to help them avoid frost damage.</p>
<p>Researchers have looked at a number of ways to measure accumulated chill, and the one that does the best job at predicting phenology events is called Chill Portions (CP) <span class="citation" data-cites="luedeling_global_2011">(<a href="references.html#ref-luedeling_global_2011" role="doc-biblioref">Luedeling and Brown 2011</a>)</span>. The calculations are a bit complicated, but fortunately there’s a R-package that will compute chill portions. For more info, see <a href="https://ucanr-igis.github.io/caladaptr-res/notebooks/chill.nb.html" target="_blank" rel="noopener">here</a>.</p>
<p><br>
</p>
</section>
<section id="frost-days" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="frost-days"><span class="header-section-number">3.5</span> Frost Days</h2>
<p>Frost Days (FD) are the number of days per year with minimum temperatures (Tn) ≤ 0 °C <span class="citation" data-cites="parker_observed_2022">(<a href="references.html#ref-parker_observed_2022" role="doc-biblioref">Parker et al. 2022</a>)</span>. They can be computed with:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>colusa_fd_tbl <span class="ot">&lt;-</span> colusa_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cvar <span class="sc">==</span> <span class="st">"tmmn"</span>, temp_f <span class="sc">&lt;=</span> <span class="fu">set_units</span>(<span class="dv">0</span>, degC)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">fd =</span> <span class="fu">n</span>())</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>colusa_fd_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 2
    year    fd
   &lt;dbl&gt; &lt;int&gt;
 1  2000     9
 2  2001    14
 3  2002    16
 4  2003    10
 5  2004     9
 6  2005     5
 7  2006    11
 8  2007    23
 9  2008     8
10  2009    24
# ℹ 11 more rows</code></pre>
</div>
</div>
<p><br>
</p>
</section>
<section id="last-spring-and-first-fall-freeze" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="last-spring-and-first-fall-freeze"><span class="header-section-number">3.6</span> Last Spring and First Fall Freeze</h2>
<p>The Last Spring Freeze (LSF) is defined as the last day of the calendar year prior to 30 June with a Tn ≤ 0 °C. Conversely the First Fall Freeze (FFF) is defined as the first day of the calendar year commencing 1 July with Tn ≤ 0 °C <span class="citation" data-cites="parker_observed_2022">(<a href="references.html#ref-parker_observed_2022" role="doc-biblioref">Parker et al. 2022</a>)</span>.</p>
<p>We can find the last freeze date by chaining together dplyr expressions that i) keep only ‘freeze days’ from January through June, ii) group the freeze days by year, and iii) taking the max date for each group:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>colusa_lf_tbl <span class="ot">&lt;-</span> colusa_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cvar <span class="sc">==</span> <span class="st">"tmmn"</span>, <span class="fu">month</span>(dt) <span class="sc">&lt;=</span> <span class="dv">6</span>, temp_f <span class="sc">&lt;=</span> <span class="fu">set_units</span>(<span class="dv">32</span>, degF)) <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">lf =</span> <span class="fu">max</span>(dt))</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>colusa_lf_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 2
    year lf        
   &lt;dbl&gt; &lt;date&gt;    
 1  2000 2000-01-28
 2  2001 2001-04-10
 3  2002 2002-03-18
 4  2003 2003-02-08
 5  2004 2004-01-05
 6  2005 2005-01-30
 7  2006 2006-02-20
 8  2007 2007-03-01
 9  2008 2008-04-20
10  2009 2009-03-23
11  2011 2011-02-28
12  2012 2012-03-23
13  2013 2013-02-26
14  2014 2014-02-04
15  2015 2015-01-03
16  2016 2016-01-01
17  2017 2017-02-28
18  2018 2018-03-05
19  2019 2019-01-04
20  2020 2020-01-04</code></pre>
</div>
</div>
<p><br>
</p>
<p>Similarly, we can find the first fall freeze by keeping only dates from July - December where the temperature dipped below freezing, then taking the minimum date for each year:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>colusa_fff_tbl <span class="ot">&lt;-</span> colusa_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cvar <span class="sc">==</span> <span class="st">"tmmn"</span>, <span class="fu">month</span>(dt) <span class="sc">&gt;=</span> <span class="dv">7</span>, temp_f <span class="sc">&lt;=</span> <span class="fu">set_units</span>(<span class="dv">32</span>, degF)) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">fff =</span> <span class="fu">min</span>(dt))</span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>colusa_fff_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 2
    year fff       
   &lt;dbl&gt; &lt;date&gt;    
 1  2000 2000-11-12
 2  2001 2001-11-27
 3  2002 2002-12-23
 4  2003 2003-11-22
 5  2004 2004-11-29
 6  2005 2005-12-04
 7  2006 2006-11-28
 8  2007 2007-12-01
 9  2008 2008-12-10
10  2009 2009-11-13
11  2010 2010-11-23
12  2011 2011-12-04
13  2012 2012-12-15
14  2013 2013-11-24
15  2015 2015-11-25
16  2016 2016-12-06
17  2017 2017-12-11
18  2018 2018-11-14
19  2019 2019-11-24
20  2020 2020-11-10</code></pre>
</div>
</div>
<p><br>
</p>
</section>
<section id="freeze-free-season" class="level2" data-number="3.7">
<h2 data-number="3.7" class="anchored" data-anchor-id="freeze-free-season"><span class="header-section-number">3.7</span> Freeze-Free Season</h2>
<p>The Freeze-Free Season (FFS) is calculated as the difference between the LSF and FFF (FFF [minus] LSF) <span class="citation" data-cites="parker_observed_2022">(<a href="references.html#ref-parker_observed_2022" role="doc-biblioref">Parker et al. 2022</a>)</span>. Since we already calculated LSF and FFF, computing the Freeze-Free Season can be done with a simple table join:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>colusa_lf_fff_tbl <span class="ot">&lt;-</span> colusa_lf_tbl <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(colusa_fff_tbl, <span class="at">by =</span> <span class="st">"year"</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>colusa_lf_fff_tbl <span class="sc">%&gt;%</span> <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
   year lf         fff       
  &lt;dbl&gt; &lt;date&gt;     &lt;date&gt;    
1  2000 2000-01-28 2000-11-12
2  2001 2001-04-10 2001-11-27
3  2002 2002-03-18 2002-12-23
4  2003 2003-02-08 2003-11-22
5  2004 2004-01-05 2004-11-29
6  2005 2005-01-30 2005-12-04</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>colusa_lf_fff_ffs_tbl <span class="ot">&lt;-</span> colusa_lf_fff_tbl <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">ffs =</span> fff <span class="sc">-</span> lf)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>colusa_lf_fff_ffs_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 20 × 4
    year lf         fff        ffs     
   &lt;dbl&gt; &lt;date&gt;     &lt;date&gt;     &lt;drtn&gt;  
 1  2000 2000-01-28 2000-11-12 289 days
 2  2001 2001-04-10 2001-11-27 231 days
 3  2002 2002-03-18 2002-12-23 280 days
 4  2003 2003-02-08 2003-11-22 287 days
 5  2004 2004-01-05 2004-11-29 329 days
 6  2005 2005-01-30 2005-12-04 308 days
 7  2006 2006-02-20 2006-11-28 281 days
 8  2007 2007-03-01 2007-12-01 275 days
 9  2008 2008-04-20 2008-12-10 234 days
10  2009 2009-03-23 2009-11-13 235 days
11  2011 2011-02-28 2011-12-04 279 days
12  2012 2012-03-23 2012-12-15 267 days
13  2013 2013-02-26 2013-11-24 271 days
14  2014 2014-02-04 NA          NA days
15  2015 2015-01-03 2015-11-25 326 days
16  2016 2016-01-01 2016-12-06 340 days
17  2017 2017-02-28 2017-12-11 286 days
18  2018 2018-03-05 2018-11-14 254 days
19  2019 2019-01-04 2019-11-24 324 days
20  2020 2020-01-04 2020-11-10 311 days</code></pre>
</div>
</div>
<p><br>
</p>
</section>
<section id="tropical-nights-and-hot-days" class="level2" data-number="3.8">
<h2 data-number="3.8" class="anchored" data-anchor-id="tropical-nights-and-hot-days"><span class="header-section-number">3.8</span> Tropical Nights and Hot Days</h2>
<p>Tropical Nights (TRN) are calculated as the number of nights per year with Tn &gt; 20 °C (68 °F) <span class="citation" data-cites="parker_observed_2022">(<a href="references.html#ref-parker_observed_2022" role="doc-biblioref">Parker et al. 2022</a>)</span>. This can be computed with:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>colusa_tn_tbl <span class="ot">&lt;-</span> colusa_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cvar <span class="sc">==</span> <span class="st">"tmmn"</span>, temp_f <span class="sc">&gt;</span> <span class="fu">set_units</span>(<span class="dv">20</span>, degC)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">tn =</span> <span class="fu">n</span>())</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>colusa_tn_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 18 × 2
    year    tn
   &lt;dbl&gt; &lt;int&gt;
 1  2000    10
 2  2001     8
 3  2002     3
 4  2003    10
 5  2004     1
 6  2005     4
 7  2006    12
 8  2007     6
 9  2008     6
10  2009     3
11  2011     2
12  2012     3
13  2013    13
14  2015    10
15  2017    15
16  2018     2
17  2019     3
18  2020    13</code></pre>
</div>
</div>
<p><br>
</p>
<p>Hot Days (HD) are defined as when Tx &gt; 38 °C <span class="citation" data-cites="parker_observed_2022">(<a href="references.html#ref-parker_observed_2022" role="doc-biblioref">Parker et al. 2022</a>)</span>. The number of hot days per year can be computed with:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>colusa_hd_tbl <span class="ot">&lt;-</span> colusa_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cvar <span class="sc">==</span> <span class="st">"tmmx"</span>, temp_f <span class="sc">&gt;</span> <span class="fu">set_units</span>(<span class="dv">38</span>, degC)) <span class="sc">%&gt;%</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">hd =</span> <span class="fu">n</span>())</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>colusa_hd_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 2
    year    hd
   &lt;dbl&gt; &lt;int&gt;
 1  2000    15
 2  2001    17
 3  2002    15
 4  2003    14
 5  2004     7
 6  2005    20
 7  2006    20
 8  2007     8
 9  2008    21
10  2009    26
# ℹ 11 more rows</code></pre>
</div>
</div>
<p><br>
</p>
</section>
<section id="extreme-heat-days" class="level2" data-number="3.9">
<h2 data-number="3.9" class="anchored" data-anchor-id="extreme-heat-days"><span class="header-section-number">3.9</span> Extreme Heat Days</h2>
<p>Extreme Heat Days (EHD) are the number of days per year with Tx &gt;98th percentile of summer (June-August) Tx for the 1981–2010 period <span class="citation" data-cites="parker_observed_2022">(<a href="references.html#ref-parker_observed_2022" role="doc-biblioref">Parker et al. 2022</a>)</span>. This is similar to HD, but with a threshold value based on the historic record. We can compute the 98th percentile of daily summertime highs with:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>colusa_ehd_thresh <span class="ot">&lt;-</span> <span class="fu">ca_loc_pt</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">122.159304</span>, <span class="fl">39.289291</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ca_slug</span>(<span class="st">"tmmx_day_gridmet"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ca_years</span>(<span class="at">start =</span> <span class="dv">1981</span>, <span class="at">end =</span> <span class="dv">2010</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ca_getvals_tbl</span>(<span class="at">quiet =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">month</span>(<span class="fu">as.Date</span>(dt)) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">6</span>,<span class="dv">7</span>,<span class="dv">8</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(val) <span class="sc">%&gt;%</span> </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">quantile</span>(<span class="fl">0.98</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_units</span>(degF)</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>colusa_ehd_thresh</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>106.2176 [degF]</code></pre>
</div>
</div>
<p><br>
</p>
<p>Once we have that threshold, we can compute Extreme Heat Days with:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>colusa_ehd_tbl <span class="ot">&lt;-</span> colusa_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cvar <span class="sc">==</span> <span class="st">"tmmx"</span>, temp_f <span class="sc">&gt;</span> colusa_ehd_thresh) <span class="sc">%&gt;%</span> </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">hd =</span> <span class="fu">n</span>())</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>colusa_ehd_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 17 × 2
    year    hd
   &lt;dbl&gt; &lt;int&gt;
 1  2001     1
 2  2002     1
 3  2003     4
 4  2005     2
 5  2006     7
 6  2007     1
 7  2008     4
 8  2009     3
 9  2010     1
10  2012    10
11  2013    12
12  2014     2
13  2015     1
14  2017     8
15  2018     1
16  2019     1
17  2020     3</code></pre>
</div>
</div>
<p><br>
</p>
</section>
<section id="heatwaves" class="level2" data-number="3.10">
<h2 data-number="3.10" class="anchored" data-anchor-id="heatwaves"><span class="header-section-number">3.10</span> Heatwaves</h2>
<p>Heatwave events (HW) are defined as 3+ consecutive days with Tx &gt; 98th percentile of 1981–2010 summer Tx (as in EHD) <span class="citation" data-cites="parker_observed_2022">(<a href="references.html#ref-parker_observed_2022" role="doc-biblioref">Parker et al. 2022</a>)</span>. Using the technique described in [Chapter 4 - Counting Consecutive Events][Counting Consecutive Events], we can compute the number of heatwaves per year.</p>
<ol type="1">
<li>Add a column for extreme heat day, then create a grouped tibble (by year):</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>colusa_grpd_tbl <span class="ot">&lt;-</span> colusa_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(cvar <span class="sc">==</span> <span class="st">"tmmx"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ehd =</span> temp_f <span class="sc">&gt;</span> colusa_ehd_thresh) <span class="sc">%&gt;%</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(dt)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(colusa_grpd_tbl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 7,671
Columns: 5
Groups: year [21]
$ year   &lt;dbl&gt; 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 2000, 200…
$ dt     &lt;date&gt; 2000-01-01, 2000-01-02, 2000-01-03, 2000-01-04, 2000-01-05, 20…
$ cvar   &lt;chr&gt; "tmmx", "tmmx", "tmmx", "tmmx", "tmmx", "tmmx", "tmmx", "tmmx",…
$ temp_f [degF] 54.95 [degF], 53.87 [degF], 57.65 [degF], 49.37 [degF], 57.47 …
$ ehd    &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, …</code></pre>
</div>
</div>
<p><br>
</p>
<ol start="2" type="1">
<li>Create a function that we can pass to <code>group_modify()</code>, will return the number of heatwaves per group (year):</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>num_hw <span class="ot">&lt;-</span> <span class="cf">function</span>(data_tbl, key_tbl, <span class="at">num_days =</span> <span class="dv">3</span>) {</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  rle_lst <span class="ot">&lt;-</span> <span class="fu">rle</span>(data_tbl<span class="sc">$</span>ehd)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tibble</span>(<span class="at">num_hw =</span> <span class="fu">sum</span>(rle_lst<span class="sc">$</span>values <span class="sc">&amp;</span> rle_lst<span class="sc">$</span>lengths <span class="sc">&gt;=</span> num_days))</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>&nbsp;</p>
<ol start="3" type="1">
<li>Apply the heatwave function to the grouped tibble:</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>colusa_hw_tbl <span class="ot">&lt;-</span> colusa_grpd_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_modify</span>(<span class="at">.f =</span> num_hw, <span class="at">num_days =</span> <span class="dv">3</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>colusa_hw_tbl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21 × 2
# Groups:   year [21]
    year num_hw
   &lt;dbl&gt;  &lt;int&gt;
 1  2000      0
 2  2001      0
 3  2002      0
 4  2003      0
 5  2004      0
 6  2005      0
 7  2006      1
 8  2007      0
 9  2008      1
10  2009      0
# ℹ 11 more rows</code></pre>
</div>
</div>
<p><br>
</p>
</section>
<section id="diurnal-temperature-range" class="level2" data-number="3.11">
<h2 data-number="3.11" class="anchored" data-anchor-id="diurnal-temperature-range"><span class="header-section-number">3.11</span> Diurnal Temperature Range</h2>
<p>Diurnal Temperature Range (DTR) is the difference between daily Tx and Tn <span class="citation" data-cites="parker_observed_2022">(<a href="references.html#ref-parker_observed_2022" role="doc-biblioref">Parker et al. 2022</a>)</span>. Below we calculate DTR over 1 March to 1 November.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>colusa_dtr_tbl <span class="ot">&lt;-</span> colusa_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">month</span>(dt) <span class="sc">%in%</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">id_cols =</span> <span class="fu">c</span>(year, dt), <span class="at">names_from =</span> cvar, <span class="at">values_from =</span> temp_f) <span class="sc">%&gt;%</span> </span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">dtr =</span> tmmx <span class="sc">-</span> tmmn)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(colusa_dtr_tbl)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 5
   year dt           tmmn   tmmx    dtr
  &lt;dbl&gt; &lt;date&gt;     [degF] [degF] [degF]
1  2000 2000-03-01   35.7   62.7  27.0 
2  2000 2000-03-02   45.9   55.5   9.54
3  2000 2000-03-03   36.6   68.6  32.0 
4  2000 2000-03-04   41.1   62.1  21.1 
5  2000 2000-03-05   46.3   55.5   9.18
6  2000 2000-03-06   43.6   56.4  12.8 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(colusa_dtr_tbl <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">year =</span> <span class="fu">as.factor</span>(year)), <span class="fu">aes</span>(<span class="at">x=</span>year, <span class="at">y =</span> dtr)) <span class="sc">+</span> </span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>() <span class="sc">+</span> </span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Diurnal Temperature Range, 2000-2020"</span>,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Colusa, CA"</span>, </span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">caption =</span> <span class="st">"Dataset: gridMet. Temporal period: March - October"</span>,</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">""</span>, <span class="at">y =</span> <span class="st">"daily temperature range"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="03_agroclimate-metrics_files/figure-html/ggplot_colusa_dtr_tbl-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="reference-evapotranspiration" class="level2" data-number="3.12">
<h2 data-number="3.12" class="anchored" data-anchor-id="reference-evapotranspiration"><span class="header-section-number">3.12</span> Reference Evapotranspiration</h2>
<p>ETo is calculated following the FAO Penman–Monteith method <span class="citation" data-cites="allen_crop_1998">(<a href="references.html#ref-allen_crop_1998" role="doc-biblioref">Allen and United Nations 1998</a>)</span>. We calculate summer (June-August) average ETo for each year 1981–2020 for our analysis. ETo units are mm <span class="citation" data-cites="parker_observed_2022">(<a href="references.html#ref-parker_observed_2022" role="doc-biblioref">Parker et al. 2022</a>)</span>.</p>
<p style="font-size:150%; font-style:italic;">
</p><p>More coming soon…</p>
<p></p>


<div id="refs" class="references csl-bib-body hanging-indent" role="list" style="display: none">
<div id="ref-allen_crop_1998" class="csl-entry" role="listitem">
Allen, R. G., and Food and Agriculture Organization of the United Nations, eds. 1998. <em>Crop Evapotranspiration: Guidelines for Computing Crop Water Requirements</em>. <span>FAO</span> Irrigation and Drainage Paper 56. Rome: Food; Agriculture Organization of the United Nations.
</div>
<div id="ref-luedeling_global_2011" class="csl-entry" role="listitem">
Luedeling, Eike, and Patrick H. Brown. 2011. <span>“A Global Analysis of the Comparability of Winter Chill Models for Fruit and Nut Trees.”</span> <em>International Journal of Biometeorology</em> 55 (3): 411–21. <a href="https://doi.org/10.1007/s00484-010-0352-y">https://doi.org/10.1007/s00484-010-0352-y</a>.
</div>
<div id="ref-mcmaster_growing_1997" class="csl-entry" role="listitem">
McMaster, G, and W Wilhelm. 1997. <span>“Growing Degree-Days: One Equation, Two Interpretations.”</span> <em>Agricultural and Forest Meteorology</em> 87 (4): 291–300. <a href="https://doi.org/10.1016/S0168-1923(97)00027-0">https://doi.org/10.1016/S0168-1923(97)00027-0</a>.
</div>
<div id="ref-parker_observed_2022" class="csl-entry" role="listitem">
Parker, Lauren E., Ning Zhang, John T. Abatzoglou, Steven M. Ostoja, and Tapan B. Pathak. 2022. <span>“Observed <span>Changes</span> in <span>Agroclimate</span> <span>Metrics</span> <span>Relevant</span> for <span>Specialty</span> <span>Crop</span> <span>Production</span> in <span>California</span>.”</span> <em>Agronomy</em> 12 (1): 205. <a href="https://doi.org/10.3390/agronomy12010205">https://doi.org/10.3390/agronomy12010205</a>.
</div>
</div>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./02_metrics-methods.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Methods for Computing Metrics</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./04_degday-chill.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Degree Days</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>